---
title: Hybrid Search
summary: Use full-text search and vector search together to improve the retrieval quality.
---

# Hybrid Search

By using full-text search, you can retrieve documents based on exact keywords. By using vector search, you can retrieve documents based on semantic similarity. So can we combine these two search methods together to improve the retrieval quality and cover more scenarios? The answer is yes! In fact, this is a common practice in AI applications, which is called hybrid search.

A general workflow of hybrid search in TiDB is as follows:

- **TiDB database** provides capabilities of both **full-text search** and **vector search**.
- Use a **reranker** to combine the results from both searches.

![Hybrid Search](/media/vector-search/hybrid-search-overview.png)

[pytidb Python SDK](https://github.com/pingcap/pytidb) has built-in embedding and reranking features and can be a good starting point. Note that using pytidb is fully optional. For example, you can perform search using SQL directly and use your own reranking model as you like.

## Prerequisites

Hybrid search relies on both [full-text search](/vector-search/vector-search-full-text-search-python.md) and vector search. Full-Text search is still in the early stages, and we are continuously rolling it out to more customers. Currently, Full-Text Search is only available for the following service and regions:

- TiDB Serverless (Europe Region)

Thus, to complete this tutorial, make sure you have a TiDB Serverless cluster in the supported regions above. If you don't have a TiDB Serverless cluster, follow [Creating a TiDB Cloud Serverless cluster](/develop/dev-guide-build-cluster-in-cloud.md) to create your own one.

## Getting Started

### Step1. Install [pytidb](https://github.com/pingcap/pytidb) Python SDK

```shell
pip install "pytidb[models]"

# If you don't want to use built-in embedding function and rerankers.
# pip install pytidb

# If you want to convert query result to pandas DataFrame.
# pip install pandas
```

### Step2. Connect to TiDB

```python
import os
from pytidb import TiDBClient

db = TiDBClient.connect(
    host="HOST_HERE",
    port=4000,
    username="USERNAME_HERE",
    password="PASSWORD_HERE",
    database="DATABASE_HERE",
)
```

The parameters above can be obtained from TiDB Cloud console:

1. Navigate to the [**Clusters**](https://tidbcloud.com/console/clusters) page, and then click the name of your target cluster to go to its overview page.

2. Click **Connect** in the upper-right corner. A connection dialog is displayed, with connection parameters listed.

   As an example, for parameters displayed like this:

   ```text
   HOST:     gateway01.us-east-1.prod.shared.aws.tidbcloud.com
   PORT:     4000
   USERNAME: 4EfqPF23YKBxaQb.root
   PASSWORD: abcd1234
   DATABASE: test
   CA:       /etc/ssl/cert.pem
   ```

   The Python code to connect to the cluster would be:

   ```python
   db = TiDBClient.connect(
       host="gateway01.us-east-1.prod.shared.aws.tidbcloud.com",
       port=4000,
       username="4EfqPF23YKBxaQb.root",
       password="abcd1234",
       database="test",
   )
   ```

   Notice that the example code above are only for demonstration purposes. You should fill in the parameters with your own values, and well protect your credentials.

## Step3. Create Table

As an example, we will create a table named `chunks` with the following schema:

- `id` (int): The ID of the chunk.
- `text` (text): The text content of the chunk.
- `text_vec` (vector): The vector representation of the text content. Vector is automatically generated by the embedding model via PyTiDB.
- `user_id` (int): The ID of the user who created the chunk.

```python
from pytidb.schema import TableModel, Field
from pytidb.embeddings import EmbeddingFunction

text_embed = EmbeddingFunction("openai/text-embedding-3-small")

class Chunk(TableModel, table=True):
    __tablename__ = "chunks"

    id: int = Field(primary_key=True)
    text: str = Field()
    text_vec: list[float] = text_embed.VectorField(
        source_field="text"
    )  # ðŸ‘ˆ Define the vector field.
    user_id: int = Field()

table = db.create_table(schema=Chunk)
```

### Step4. Insert Data

```python
table.bulk_insert(
    [
        Chunk(id=2, text="bar", user_id=2),   # ðŸ‘ˆ The text field will be embedded to a
        Chunk(id=3, text="baz", user_id=3),   # vector and save to the text_vec field
        Chunk(id=4, text="qux", user_id=4),   # automatically.
    ]
)
```

### Step5. Perform Hybrid Search

In this example, we use [jina-reranker](https://huggingface.co/jinaai/jina-reranker-m0) model to rerank the query result.

```python
from pytidb.rerankers import Reranker

jinaai = Reranker(model_name="jina_ai/jina-reranker-m0")

df = (
  table.search("<query>", search_type="hybrid")
    .rerank(jinaai, "text")  # ðŸ‘ˆ Rerank the query result with the jinaai model.
    .limit(2)
    .to_pandas()
)
```

See [PyTiDB Hybrid Search demo](https://github.com/pingcap/pytidb/tree/main/examples/hybrid_search) for a more complete example.

## See also

- [pytidb Python SDK Documentation](https://github.com/pingcap/pytidb)

- [Full-Text Search with Python](/vector-search/vector-search-full-text-search-python.md)

## Feedback & Help

Full-text search is still in the early stages with limited accessibility. If you would like to try full-text search in a region that is not yet available, or if you have feedback or need help, feel free to reach out to us:

<CustomContent platform="tidb">

- [Join our Discord](https://discord.gg/zcqexutz2R)

</CustomContent>

<CustomContent platform="tidb-cloud">

- [Join our Discord](https://discord.gg/zcqexutz2R)
- [Visit our Support Portal](https://tidb.support.pingcap.com/)

</CustomContent>
