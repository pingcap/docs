---
title: Table Filter
summary: TiDB å·¥å…·ä¸­è¡¨è¿‡æ»¤å™¨åŠŸèƒ½çš„ä½¿ç”¨æ–¹æ³•ã€‚
---

# Table Filter

TiDB è¿ç§»å·¥å…·é»˜è®¤ä¼šæ“ä½œæ‰€æœ‰æ•°æ®åº“ï¼Œä½†é€šå¸¸åªéœ€è¦å…¶ä¸­çš„ä¸€éƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œä½ åªæƒ³å¤„ç†å½¢å¦‚ `foo*` å’Œ `bar*` çš„ schemaï¼Œè€Œä¸éœ€è¦å…¶ä»–çš„ã€‚

è‡ª TiDB 4.0 èµ·ï¼Œæ‰€æœ‰ TiDB è¿ç§»å·¥å…·éƒ½å…±äº«ä¸€å¥—é€šç”¨çš„è¿‡æ»¤å™¨è¯­æ³•æ¥å®šä¹‰å­é›†ã€‚æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•ä½¿ç”¨è¡¨è¿‡æ»¤å™¨åŠŸèƒ½ã€‚

## ä½¿ç”¨æ–¹æ³•

### CLI

å¯ä»¥é€šè¿‡å¤šä¸ª `-f` æˆ– `--filter` å‘½ä»¤è¡Œå‚æ•°ä¸ºå·¥å…·åº”ç”¨è¡¨è¿‡æ»¤å™¨ã€‚æ¯ä¸ªè¿‡æ»¤å™¨çš„æ ¼å¼ä¸º `db.table`ï¼Œå…¶ä¸­æ¯ä¸€éƒ¨åˆ†éƒ½å¯ä»¥æ˜¯é€šé…ç¬¦ï¼ˆè¯¦è§[ä¸‹ä¸€èŠ‚](#wildcards)ï¼‰ã€‚ä»¥ä¸‹æ˜¯ç¤ºä¾‹ç”¨æ³•ã€‚

<CustomContent platform="tidb">

* [BR](/br/backup-and-restore-overview.md)ï¼š

    ```shell
    tiup br backup full -f 'foo*.*' -f 'bar*.*' -s 'local:///tmp/backup'
    ```

    ```shell
    tiup br restore full -f 'foo*.*' -f 'bar*.*' -s 'local:///tmp/backup'
    ```

</CustomContent>

* [Dumpling](https://docs.pingcap.com/tidb/stable/dumpling-overview)ï¼š

    ```shell
    tiup dumpling -f 'foo*.*' -f 'bar*.*' -P 3306 -o /tmp/data/
    ```

<CustomContent platform="tidb">

* [TiDB Lightning](/tidb-lightning/tidb-lightning-overview.md)ï¼š

    ```shell
    tiup tidb-lightning -f 'foo*.*' -f 'bar*.*' -d /tmp/data/ --backend tidb
    ```

</CustomContent>

<CustomContent platform="tidb-cloud">

* [TiDB Lightning](https://docs.pingcap.com/tidb/stable/tidb-lightning-overview)ï¼š

    ```shell
    tiup tidb-lightning -f 'foo*.*' -f 'bar*.*' -d /tmp/data/ --backend tidb
    ```

</CustomContent>

### TOML é…ç½®æ–‡ä»¶

åœ¨ TOML æ–‡ä»¶ä¸­ï¼Œè¡¨è¿‡æ»¤å™¨ä»¥ [å­—ç¬¦ä¸²æ•°ç»„](https://toml.io/en/v1.0.0-rc.1#section-15) çš„å½¢å¼æŒ‡å®šã€‚ä»¥ä¸‹æ˜¯ç¤ºä¾‹ç”¨æ³•ã€‚

* TiDB Lightningï¼š

    ```toml
    [mydumper]
    filter = ['foo*.*', 'bar*.*']
    ```

<CustomContent platform="tidb">

* [TiCDC](/ticdc/ticdc-overview.md)ï¼š

    ```toml
    [filter]
    rules = ['foo*.*', 'bar*.*']

    [[sink.dispatchers]]
    matcher = ['db1.*', 'db2.*', 'db3.*']
    dispatcher = 'ts'
    ```

</CustomContent>

## è¯­æ³•

### æ™®é€šè¡¨å

æ¯æ¡è¡¨è¿‡æ»¤è§„åˆ™ç”±â€œschema æ¨¡å¼â€å’Œâ€œè¡¨æ¨¡å¼â€ç»„æˆï¼Œä¸¤è€…ä¹‹é—´ç”¨ç‚¹ï¼ˆ`.`ï¼‰åˆ†éš”ã€‚åªæœ‰å®Œå…¨é™å®šååŒ¹é…è§„åˆ™çš„è¡¨æ‰ä¼šè¢«æ¥å—ã€‚

```
db1.tbl1
db2.tbl2
db3.tbl3
```

æ™®é€šåç§°åªèƒ½åŒ…å«æœ‰æ•ˆçš„[æ ‡è¯†ç¬¦å­—ç¬¦](/schema-object-names.md)ï¼Œä¾‹å¦‚ï¼š

* æ•°å­—ï¼ˆ`0` åˆ° `9`ï¼‰
* å­—æ¯ï¼ˆ`a` åˆ° `z`ï¼Œ`A` åˆ° `Z`ï¼‰
* `$`
* `_`
* é ASCII å­—ç¬¦ï¼ˆU+0080 åˆ° U+10FFFFï¼‰

æ‰€æœ‰å…¶ä»– ASCII å­—ç¬¦ä¸ºä¿ç•™å­—ç¬¦ã€‚ä¸€äº›æ ‡ç‚¹ç¬¦å·æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œè¯¦è§ä¸‹ä¸€èŠ‚ã€‚

### é€šé…ç¬¦

åç§°çš„æ¯ä¸€éƒ¨åˆ†éƒ½å¯ä»¥ä½¿ç”¨ [fnmatch(3)](https://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_13) ä¸­æè¿°çš„é€šé…ç¬¦ç¬¦å·ï¼š

* `*` â€” åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå­—ç¬¦
* `?` â€” åŒ¹é…ä¸€ä¸ªå­—ç¬¦
* `[a-z]` â€” åŒ¹é…ä¸€ä¸ªä»‹äº "a" å’Œ "z" ä¹‹é—´çš„å­—ç¬¦ï¼ˆåŒ…å«ä¸¤ç«¯ï¼‰
* `[!a-z]` â€” åŒ¹é…ä¸€ä¸ªä¸æ˜¯ "a" åˆ° "z" çš„å­—ç¬¦

```
db[0-9].tbl[0-9a-f][0-9a-f]
data.*
*.backup_*
```

æ­¤å¤„çš„â€œå­—ç¬¦â€æŒ‡çš„æ˜¯ä¸€ä¸ª Unicode ç ç‚¹ï¼Œä¾‹å¦‚ï¼š

* U+00E9 (Ã©) æ˜¯ 1 ä¸ªå­—ç¬¦ã€‚
* U+0065 U+0301 (eÌ) æ˜¯ 2 ä¸ªå­—ç¬¦ã€‚
* U+1F926 U+1F3FF U+200D U+2640 U+FE0F (ğŸ¤¦ğŸ¿â€â™€ï¸) æ˜¯ 5 ä¸ªå­—ç¬¦ã€‚

### æ–‡ä»¶å¯¼å…¥

è¦å°†æ–‡ä»¶ä½œä¸ºè¿‡æ»¤è§„åˆ™å¯¼å…¥ï¼Œåœ¨è§„åˆ™å¼€å¤´åŠ ä¸Š `@` å¹¶æŒ‡å®šæ–‡ä»¶åã€‚è¡¨è¿‡æ»¤å™¨è§£æå™¨ä¼šå°†å¯¼å…¥æ–‡ä»¶çš„æ¯ä¸€è¡Œè§†ä¸ºé¢å¤–çš„è¿‡æ»¤è§„åˆ™ã€‚

ä¾‹å¦‚ï¼Œè‹¥æ–‡ä»¶ `config/filter.txt` å†…å®¹å¦‚ä¸‹ï¼š

```
employees.*
*.WorkOrder
```

åˆ™ä»¥ä¸‹ä¸¤ç§è°ƒç”¨æ–¹å¼ç­‰ä»·ï¼š

```bash
tiup dumpling -f '@config/filter.txt'
tiup dumpling -f 'employees.*' -f '*.WorkOrder'
```

è¿‡æ»¤å™¨æ–‡ä»¶ä¸èƒ½å†è¿›ä¸€æ­¥å¯¼å…¥å…¶ä»–æ–‡ä»¶ã€‚

### æ³¨é‡Šä¸ç©ºè¡Œ

åœ¨è¿‡æ»¤å™¨æ–‡ä»¶ä¸­ï¼Œæ¯è¡Œçš„é¦–å°¾ç©ºç™½å­—ç¬¦ä¼šè¢«å»é™¤ã€‚æ­¤å¤–ï¼Œç©ºè¡Œï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰ä¼šè¢«å¿½ç•¥ã€‚

ä»¥ `#` å¼€å¤´çš„è¡Œä¸ºæ³¨é‡Šï¼Œä¼šè¢«å¿½ç•¥ã€‚`#` è‹¥ä¸åœ¨è¡Œé¦–ï¼Œåˆ™ä¼šè¢«è§†ä¸ºè¯­æ³•é”™è¯¯ã€‚

```
# this line is a comment
db.table   # but this part is not comment and may cause error
```

### æ’é™¤è§„åˆ™

ä»¥ `!` å¼€å¤´çš„è§„åˆ™è¡¨ç¤ºå…¶åçš„æ¨¡å¼ç”¨äºæ’é™¤ä¸éœ€è¦å¤„ç†çš„è¡¨ã€‚è¿™æ ·å¯ä»¥å°†è¿‡æ»¤å™¨å˜ä¸ºé˜»æ­¢åˆ—è¡¨ã€‚

```
*.*
#^ æ³¨æ„ï¼šå¿…é¡»å…ˆæ·»åŠ  *.* ä»¥åŒ…å«æ‰€æœ‰è¡¨
!*.Password
!employees.salaries
```

### è½¬ä¹‰å­—ç¬¦

è¦å°†ç‰¹æ®Šå­—ç¬¦ä½œä¸ºæ ‡è¯†ç¬¦å­—ç¬¦ä½¿ç”¨ï¼Œå¯ä»¥åœ¨å…¶å‰é¢åŠ åæ–œæ  `\`ã€‚

```
db\.with\.dots.*
```

ä¸ºç®€åŒ–å’Œå…¼å®¹æœªæ¥ï¼Œç¦æ­¢ä»¥ä¸‹è½¬ä¹‰åºåˆ—ï¼š

* å»é™¤ç©ºç™½åï¼Œ`\` ä½äºè¡Œå°¾ï¼ˆå¦‚éœ€åŒ¹é…è¡Œå°¾çš„ç©ºæ ¼ï¼Œè¯·ä½¿ç”¨ `[ ]`ï¼‰ã€‚
* `\` åè·Ÿä»»æ„ ASCII å­—æ¯æˆ–æ•°å­—ï¼ˆ`[0-9a-zA-Z]`ï¼‰ã€‚ç‰¹åˆ«æ˜¯ï¼Œç±»ä¼¼ C è¯­è¨€çš„è½¬ä¹‰åºåˆ—å¦‚ `\0`ã€`\r`ã€`\n` å’Œ `\t` å½“å‰æ— æ„ä¹‰ã€‚

### å¼•å·æ ‡è¯†ç¬¦

é™¤äº† `\`ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä½¿ç”¨ `"` æˆ– `` ` `` å¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œå¼•ç”¨æ¥æŠ‘åˆ¶å…¶ç‰¹æ®Šå«ä¹‰ã€‚

```
"db.with.dots"."tbl\1"
`db.with.dots`.`tbl\2`
```

å¯ä»¥é€šè¿‡é‡å¤å¼•å·æœ¬èº«å°†å…¶åŒ…å«åœ¨æ ‡è¯†ç¬¦ä¸­ã€‚

```
"foo""bar".`foo``bar`
# ç­‰ä»·äºï¼š
foo\"bar.foo\`bar
```

å¸¦å¼•å·çš„æ ‡è¯†ç¬¦ä¸èƒ½è·¨å¤šè¡Œã€‚

éƒ¨åˆ†å¼•ç”¨æ ‡è¯†ç¬¦æ˜¯æ— æ•ˆçš„ï¼š

```
"this is "invalid*.*
```

### æ­£åˆ™è¡¨è¾¾å¼

å¦‚æœéœ€è¦éå¸¸å¤æ‚çš„è§„åˆ™ï¼Œæ¯ä¸ªæ¨¡å¼éƒ½å¯ä»¥ç”¨ `/` åˆ†éš”çš„æ­£åˆ™è¡¨è¾¾å¼è¡¨ç¤ºï¼š

```
/^db\d{2,}$/./^tbl\d{2,}$/
```

è¿™äº›æ­£åˆ™è¡¨è¾¾å¼é‡‡ç”¨ [Go æ–¹è¨€](https://pkg.go.dev/regexp/syntax?tab=doc)ã€‚åªè¦æ ‡è¯†ç¬¦åŒ…å«ä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„å­ä¸²ï¼Œå°±ä¼šåŒ¹é…ã€‚ä¾‹å¦‚ï¼Œ`/b/` ä¼šåŒ¹é… `db01`ã€‚

> **æ³¨æ„ï¼š**
>
> æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„æ¯ä¸ª `/` éƒ½å¿…é¡»è½¬ä¹‰ä¸º `\/`ï¼ŒåŒ…æ‹¬åœ¨ `[â€¦]` å†…éƒ¨ã€‚ä¸èƒ½åœ¨ `\Qâ€¦\E` ä¹‹é—´æ”¾ç½®æœªè½¬ä¹‰çš„ `/`ã€‚

## å¤šæ¡è§„åˆ™

å½“è¡¨åä¸åŒ¹é…è¿‡æ»¤å™¨åˆ—è¡¨ä¸­çš„ä»»ä½•è§„åˆ™æ—¶ï¼Œé»˜è®¤è¡Œä¸ºæ˜¯å¿½ç•¥è¿™äº›æœªåŒ¹é…çš„è¡¨ã€‚

è¦æ„å»ºé˜»æ­¢åˆ—è¡¨ï¼Œå¿…é¡»å°† `*.*` ä½œä¸ºç¬¬ä¸€æ¡è§„åˆ™ï¼Œå¦åˆ™æ‰€æœ‰è¡¨éƒ½ä¼šè¢«æ’é™¤ã€‚

```bash
# æ‰€æœ‰è¡¨éƒ½ä¼šè¢«è¿‡æ»¤æ‰
tiup dumpling -f '!*.Password'

# åªæœ‰ "Password" è¡¨ä¼šè¢«è¿‡æ»¤æ‰ï¼Œå…¶ä½™è¡¨ä¼šè¢«åŒ…å«
tiup dumpling -f '*.*' -f '!*.Password'
```

åœ¨è¿‡æ»¤å™¨åˆ—è¡¨ä¸­ï¼Œå¦‚æœè¡¨ååŒ¹é…å¤šæ¡è§„åˆ™ï¼Œåˆ™ä»¥æœ€åä¸€æ¡åŒ¹é…è§„åˆ™ä¸ºå‡†ã€‚ä¾‹å¦‚ï¼š

```
# è§„åˆ™ 1
employees.*
# è§„åˆ™ 2
!*.dep*
# è§„åˆ™ 3
*.departments
```

è¿‡æ»¤ç»“æœå¦‚ä¸‹ï¼š

| è¡¨å                   | è§„åˆ™ 1 | è§„åˆ™ 2 | è§„åˆ™ 3 | ç»“æœ                |
|------------------------|--------|--------|--------|---------------------|
| irrelevant.table       |        |        |        | é»˜è®¤ï¼ˆæ‹’ç»ï¼‰        |
| employees.employees    | âœ“      |        |        | è§„åˆ™ 1ï¼ˆæ¥å—ï¼‰      |
| employees.dept_emp     | âœ“      | âœ“      |        | è§„åˆ™ 2ï¼ˆæ‹’ç»ï¼‰      |
| employees.departments  | âœ“      | âœ“      | âœ“      | è§„åˆ™ 3ï¼ˆæ¥å—ï¼‰      |
| else.departments       |        | âœ“      | âœ“      | è§„åˆ™ 3ï¼ˆæ¥å—ï¼‰      |

> **æ³¨æ„ï¼š**
>
> åœ¨ TiDB å·¥å…·ä¸­ï¼Œç³»ç»Ÿ schema åœ¨é»˜è®¤é…ç½®ä¸‹å§‹ç»ˆä¼šè¢«æ’é™¤ã€‚ç³»ç»Ÿ schema åŒ…æ‹¬ï¼š
>
> * `INFORMATION_SCHEMA`
> * `PERFORMANCE_SCHEMA`
> * `METRICS_SCHEMA`
> * `INSPECTION_SCHEMA`
> * `mysql`
> * `sys`
