---
title: Table Filter
summary: åœ¨ TiDB å·¥å…·ä¸­ä½¿ç”¨è¡¨è¿‡æ»¤åŠŸèƒ½ã€‚
---

# Table Filter

TiDB è¿ç§»å·¥å…·é»˜è®¤å¯¹æ‰€æœ‰æ•°æ®åº“è¿›è¡Œæ“ä½œï¼Œä½† oftentimes åªéœ€è¦å…¶ä¸­çš„å­é›†ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½åªæƒ³å¤„ç†ä»¥ `foo*` å’Œ `bar*` å½¢å¼çš„ schemaï¼Œè€Œä¸æ¶‰åŠå…¶ä»–ã€‚

è‡ª TiDB 4.0 ç‰ˆæœ¬èµ·ï¼Œæ‰€æœ‰ TiDB è¿ç§»å·¥å…·å…±äº«ä¸€ç§é€šç”¨çš„è¿‡æ»¤è¯­æ³•ï¼Œç”¨äºå®šä¹‰å­é›†ã€‚æœ¬æ–‡ä»¶æè¿°å¦‚ä½•ä½¿ç”¨è¡¨è¿‡æ»¤åŠŸèƒ½ã€‚

## Usage

### CLI

å¯ä»¥é€šè¿‡å¤šä¸ª `-f` æˆ– `--filter` å‘½ä»¤è¡Œå‚æ•°å¯¹å·¥å…·åº”ç”¨è¡¨è¿‡æ»¤ã€‚æ¯ä¸ªè¿‡æ»¤è§„åˆ™çš„æ ¼å¼ä¸º `db.table`ï¼Œå…¶ä¸­æ¯ä¸€éƒ¨åˆ†å¯ä»¥æ˜¯é€šé…ç¬¦ï¼ˆåœ¨[ä¸‹ä¸€èŠ‚](#wildcards)ä¸­è¿›ä¸€æ­¥è¯´æ˜ï¼‰ã€‚ä»¥ä¸‹åˆ—å‡ºç¤ºä¾‹ç”¨æ³•ã€‚

<CustomContent platform="tidb">

* [BR](/br/backup-and-restore-overview.md):

    ```shell
    tiup br backup full -f 'foo*.*' -f 'bar*.*' -s 'local:///tmp/backup'
    ```

    ```shell
    tiup br restore full -f 'foo*.*' -f 'bar*.*' -s 'local:///tmp/backup'
    ```

</CustomContent>

* [Dumpling](https://docs.pingcap.com/tidb/stable/dumpling-overview):

    ```shell
    tiup dumpling -f 'foo*.*' -f 'bar*.*' -P 3306 -o /tmp/data/
    ```

<CustomContent platform="tidb">

* [TiDB Lightning](/tidb-lightning/tidb-lightning-overview.md):

    ```shell
    tiup tidb-lightning -f 'foo*.*' -f 'bar*.*' -d /tmp/data/ --backend tidb
    ```

</CustomContent>

<CustomContent platform="tidb-cloud">

* [TiDB Lightning](https://docs.pingcap.com/tidb/stable/tidb-lightning-overview):

    ```shell
    tiup tidb-lightning -f 'foo*.*' -f 'bar*.*' -d /tmp/data/ --backend tidb
    ```

</CustomContent>

### TOML é…ç½®æ–‡ä»¶

TOML æ–‡ä»¶ä¸­çš„è¡¨è¿‡æ»¤è§„åˆ™ä»¥ [å­—ç¬¦ä¸²æ•°ç»„](https://toml.io/en/v1.0.0-rc.1#section-15) å½¢å¼æŒ‡å®šã€‚ä»¥ä¸‹åˆ—å‡ºç¤ºä¾‹ç”¨æ³•ã€‚

* TiDB Lightning:

    ```toml
    [mydumper]
    filter = ['foo*.*', 'bar*.*']
    ```

<CustomContent platform="tidb">

* [TiCDC](/ticdc/ticdc-overview.md):

    ```toml
    [filter]
    rules = ['foo*.*', 'bar*.*']

    [[sink.dispatchers]]
    matcher = ['db1.*', 'db2.*', 'db3.*']
    dispatcher = 'ts'
    ```

</CustomContent>

## è¯­æ³•

### æ™®é€šè¡¨å

æ¯ä¸ªè¡¨è¿‡æ»¤è§„åˆ™ç”±â€œschema æ¨¡å¼â€å’Œâ€œè¡¨ æ¨¡å¼â€ç»„æˆï¼Œç”¨ç‚¹ï¼ˆ`.`ï¼‰åˆ†éš”ã€‚å®Œå…¨é™å®šååŒ¹é…è§„åˆ™çš„è¡¨å°†è¢«æ¥å—ã€‚

```
db1.tbl1
db2.tbl2
db3.tbl3
```

æ™®é€šåç§°å¿…é¡»ä»…ç”±æœ‰æ•ˆçš„ [æ ‡è¯†ç¬¦å­—ç¬¦](/schema-object-names.md) ç»„æˆï¼Œä¾‹å¦‚ï¼š

* æ•°å­—ï¼ˆ`0` åˆ° `9`ï¼‰
* å­—æ¯ï¼ˆ`a` åˆ° `z`ï¼Œ`A` åˆ° `Z`ï¼‰
* `$`
* `_`
* é ASCII å­—ç¬¦ï¼ˆU+0080 åˆ° U+10FFFFï¼‰

æ‰€æœ‰å…¶ä»– ASCII å­—ç¬¦ä¸ºä¿ç•™å­—ç¬¦ã€‚æŸäº›æ ‡ç‚¹ç¬¦å·å…·æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œè¯¦è§ä¸‹ä¸€èŠ‚ã€‚

### é€šé…ç¬¦

åç§°çš„æ¯ä¸€éƒ¨åˆ†å¯ä»¥æ˜¯ [fnmatch(3)] ä¸­æè¿°çš„é€šé…ç¬¦ç¬¦å·ï¼š

* `*` â€” åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå­—ç¬¦
* `?` â€” åŒ¹é…ä¸€ä¸ªå­—ç¬¦
* `[a-z]` â€” åŒ¹é…èŒƒå›´åœ¨ â€œaâ€ åˆ° â€œzâ€ ä¹‹é—´çš„ä¸€ä¸ªå­—ç¬¦
* `[!a-z]` â€” åŒ¹é…é™¤ â€œaâ€ åˆ° â€œzâ€ ä¹‹å¤–çš„ä¸€ä¸ªå­—ç¬¦

```
db[0-9].tbl[0-9a-f][0-9a-f]
data.*
*.backup_*
```

è¿™é‡Œçš„â€œå­—ç¬¦â€æŒ‡çš„æ˜¯ Unicode ç ç‚¹ï¼Œä¾‹å¦‚ï¼š

* U+00E9ï¼ˆÃ©ï¼‰æ˜¯ 1 ä¸ªå­—ç¬¦ã€‚
* U+0065 U+0301ï¼ˆeÌï¼‰æ˜¯ 2 ä¸ªå­—ç¬¦ã€‚
* U+1F926 U+1F3FF U+200D U+2640 U+FE0Fï¼ˆğŸ¤¦ğŸ¿â€â™€ï¸ï¼‰æ˜¯ 5 ä¸ªå­—ç¬¦ã€‚

### æ–‡ä»¶å¯¼å…¥

è‹¥è¦å°†æ–‡ä»¶ä½œä¸ºè¿‡æ»¤è§„åˆ™å¯¼å…¥ï¼Œåœ¨è§„åˆ™å‰åŠ ä¸Š `@` æ¥æŒ‡å®šæ–‡ä»¶åã€‚è¡¨è¿‡æ»¤è§£æå™¨ä¼šå°†å¯¼å…¥æ–‡ä»¶çš„æ¯ä¸€è¡Œè§†ä¸ºé¢å¤–çš„è¿‡æ»¤è§„åˆ™ã€‚

ä¾‹å¦‚ï¼Œæ–‡ä»¶ `config/filter.txt` å†…å®¹å¦‚ä¸‹ï¼š

```
employees.*
*.WorkOrder
```

ä»¥ä¸‹ä¸¤ä¸ªè°ƒç”¨ç­‰ä»·ï¼š

```bash
tiup dumpling -f '@config/filter.txt'
tiup dumpling -f 'employees.*' -f '*.WorkOrder'
```

ä¸€ä¸ªè¿‡æ»¤æ–‡ä»¶ä¸èƒ½å†å¯¼å…¥å…¶ä»–æ–‡ä»¶ã€‚

### æ³¨é‡Šä¸ç©ºè¡Œ

åœ¨è¿‡æ»¤æ–‡ä»¶ä¸­ï¼Œæ¯è¡Œçš„å‰åç©ºç™½å­—ç¬¦ä¼šè¢«è£å‰ªã€‚ç©ºç™½è¡Œï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰ä¼šè¢«å¿½ç•¥ã€‚

ä»¥ `#` å¼€å¤´çš„è¡Œä¸ºæ³¨é‡Šè¡Œï¼Œç³»ç»Ÿä¼šå¿½ç•¥ã€‚`#` ä¸åœ¨è¡Œé¦–åˆ™è§†ä¸ºè¯­æ³•é”™è¯¯ã€‚

```
# this line is a comment
db.table   # but this part is not comment and may cause error
```

### æ’é™¤è§„åˆ™

ä»¥ `!` å¼€å¤´çš„è§„åˆ™è¡¨ç¤ºå…¶åæ¨¡å¼ç”¨äºæ’é™¤ä¸å¤„ç†çš„è¡¨ã€‚è¿™å®é™…ä¸Šå°†è¿‡æ»¤å™¨å˜æˆäº†ä¸€ä¸ªé˜»æ­¢åˆ—è¡¨ã€‚

```
*.*
#^ note: must add the *.* to include all tables first
!*.Password
!employees.salaries
```

### è½¬ä¹‰å­—ç¬¦

è‹¥è¦å°†ç‰¹æ®Šå­—ç¬¦ä½œä¸ºæ ‡è¯†ç¬¦å­—ç¬¦ä½¿ç”¨ï¼Œåœ¨å…¶å‰é¢åŠ ä¸Šåæ–œæ  `\`ã€‚

```
db\.with\.dots.*
```

ä¸ºç®€ä¾¿èµ·è§åŠæœªæ¥å…¼å®¹ï¼Œç¦æ­¢ä½¿ç”¨ä»¥ä¸‹åºåˆ—ï¼š

* è¡Œå°¾çš„ `\`ï¼ˆåœ¨è£å‰ªç©ºç™½åï¼‰â€”â€”è¯·ç”¨ `[ ]` æ¥åŒ¹é…å­—é¢ç©ºç™½å­—ç¬¦
* `\` åè·Ÿä»»ä½• ASCII å­—æ¯æ•°å­—å­—ç¬¦ï¼ˆ`[0-9a-zA-Z]`ï¼‰ã€‚ç‰¹åˆ«æ˜¯ï¼Œç±»ä¼¼ C è¯­è¨€çš„è½¬ä¹‰åºåˆ—å¦‚ `\0`ã€`\r`ã€`\n` å’Œ `\t` ç›®å‰æ— æ„ä¹‰ã€‚

### å¼•å·æ ‡è¯†ç¬¦

é™¤äº† `\`ï¼Œè¿˜å¯ä»¥ç”¨ `"` æˆ– `` ` `` å¼•ç”¨ç‰¹æ®Šå­—ç¬¦ä»¥æŠ‘åˆ¶å…¶ç‰¹æ®Šå«ä¹‰ã€‚

```
"db.with.dots"."tbl\1"
`db.with.dots`.`tbl\2`
```

å¼•å·å¯ä»¥åœ¨æ ‡è¯†ç¬¦ä¸­é€šè¿‡é‡å¤è‡ªèº«æ¥åŒ…å«ã€‚

```
"foo""bar".`foo``bar`
# ç­‰ä»·äºï¼š
foo\"bar.foo\`bar
```

å¼•å·æ ‡è¯†ç¬¦ä¸èƒ½è·¨å¤šè¡Œã€‚

éƒ¨åˆ†å¼•å·çš„æ ‡è¯†ç¬¦æ˜¯æ— æ•ˆçš„ï¼Œä¾‹å¦‚ï¼š

```
"this is "invalid*.*
```

### æ­£åˆ™è¡¨è¾¾å¼

å¦‚æœéœ€è¦éå¸¸å¤æ‚çš„è§„åˆ™ï¼Œå¯ä»¥ç”¨ `/` åŒ…è£¹çš„æ­£åˆ™è¡¨è¾¾å¼å®šä¹‰æ¯ä¸ªæ¨¡å¼ï¼š

```
/^db\d{2,}$/./^tbl\d{2,}$/
```

è¿™äº›æ­£åˆ™è¡¨è¾¾å¼ä½¿ç”¨ [Go æ–¹è¨€](https://pkg.go.dev/regexp/syntax?tab=doc)ã€‚å¦‚æœæ ‡è¯†ç¬¦ä¸­åŒ…å«åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„å­ä¸²ï¼Œåˆ™åŒ¹é…ã€‚ä¾‹å¦‚ï¼Œ`/b/` ä¼šåŒ¹é… `db01`ã€‚

> **Note:**
>
> æ¯ä¸ª `/` åœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­éƒ½å¿…é¡»ç”¨ `\/` è½¬ä¹‰ï¼ŒåŒ…æ‹¬åœ¨ `[ ]` å†…ã€‚ä¸èƒ½åœ¨ `\Qâ€¦\E` ä¹‹é—´æ”¾ç½®æœªè½¬ä¹‰çš„ `/`ã€‚

## å¤šä¸ªè§„åˆ™

<CustomContent platform="tidb-cloud">

> **Note:**
>
> è¿™éƒ¨åˆ†å†…å®¹ä¸é€‚ç”¨äº TiDB Cloudã€‚ç›®å‰ï¼ŒTiDB Cloud ä»…æ”¯æŒä¸€ä¸ªè¡¨è¿‡æ»¤è§„åˆ™ã€‚

</CustomContent>

å½“è¡¨åæœªåŒ¹é…è¿‡æ»¤åˆ—è¡¨ä¸­çš„ä»»ä½•è§„åˆ™æ—¶ï¼Œé»˜è®¤è¡Œä¸ºæ˜¯å¿½ç•¥è¿™äº›æœªåŒ¹é…çš„è¡¨ã€‚

è‹¥è¦å»ºç«‹é˜»æ­¢åˆ—è¡¨ï¼Œå¿…é¡»åœ¨ç¬¬ä¸€ä¸ªè§„åˆ™ä¸­æ˜ç¡®ä½¿ç”¨ `*.*`ï¼Œå¦åˆ™æ‰€æœ‰è¡¨éƒ½å°†è¢«æ’é™¤ã€‚

```bash
# æ‰€æœ‰è¡¨éƒ½å°†è¢«è¿‡æ»¤
tiup dumpling -f '!*.Password'

# ä»…è¿‡æ»¤æ‰ â€œPasswordâ€ è¡¨ï¼Œå…¶ä½™éƒ½åŒ…å«
tiup dumpling -f '*.*' -f '!*.Password'
```

åœ¨è¿‡æ»¤åˆ—è¡¨ä¸­ï¼Œå¦‚æœä¸€ä¸ªè¡¨ååŒ¹é…å¤šä¸ªæ¨¡å¼ï¼Œæœ€ååŒ¹é…çš„è§„åˆ™å†³å®šç»“æœã€‚ä¾‹å¦‚ï¼š

```
# è§„åˆ™ 1
employees.*
# è§„åˆ™ 2
!*.dep*
# è§„åˆ™ 3
*.departments
```

è¿‡æ»¤ç»“æœå¦‚ä¸‹ï¼š

| è¡¨å                  | è§„åˆ™ 1 | è§„åˆ™ 2 | è§„åˆ™ 3 | ç»“æœ             |
|-----------------------|--------|--------|--------|------------------|
| irrelevant.table      |        |        |        | é»˜è®¤ï¼ˆæ‹’ç»ï¼‰     |
| employees.employees   | âœ“      |        |        | è§„åˆ™ 1ï¼ˆæ¥å—ï¼‰   |
| employees.dept_emp    | âœ“      | âœ“      |        | è§„åˆ™ 2ï¼ˆæ‹’ç»ï¼‰   |
| employees.departments | âœ“      | âœ“      | âœ“      | è§„åˆ™ 3ï¼ˆæ¥å—ï¼‰   |
| else.departments      |        | âœ“      | âœ“      | è§„åˆ™ 3ï¼ˆæ¥å—ï¼‰   |

> **Note:**
>
> åœ¨ TiDB å·¥å…·ä¸­ï¼Œç³»ç»Ÿ schema é»˜è®¤ä¸åŒ…å«åœ¨è¿‡æ»¤ä¸­ã€‚ç³»ç»Ÿ schema æœ‰ï¼š
>
> * `INFORMATION_SCHEMA`
> * `PERFORMANCE_SCHEMA`
> * `METRICS_SCHEMA`
> * `INSPECTION_SCHEMA`
> * `mysql`
> * `sys`