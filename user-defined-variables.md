---
title: User-Defined Variables
summary: このドキュメントでは、TiDBのユーザー定義変数について説明します。ユーザー定義変数はセッション固有であり、`SET`ステートメントを使用して設定し、`SELECT`ステートメントを使用して読み取ります。16進リテラルやバイナリリテラルを使用する場合は、バイナリ文字列として扱われます。MySQLとTiDBでサポートされる構文はほぼ同じです。
---

# ユーザー定義変数 {#user-defined-variables}

このドキュメントでは、TiDB のユーザー定義変数の概念と、ユーザー定義変数を設定および読み取る方法について説明します。

> **警告：**
>
> ユーザー定義変数はまだ実験的機能です。本番環境でこれらを使用することは**お**勧めできません。

ユーザー定義変数の形式は`@var_name`です。 `var_name`を構成する文字には、数字`0-9` 、文字`a-zA-Z` 、アンダースコア`_` 、ドル記号`$` 、UTF-8 文字など、識別子を構成できる任意の文字を使用できます。さらに、英語のピリオドも含まれます`.` 。ユーザー定義変数では大文字と小文字が区別されません。

ユーザー定義変数はセッション固有です。つまり、あるクライアント接続で定義されたユーザー変数は、他のクライアント接続では表示または使用できません。

## ユーザー定義変数を設定する {#set-the-user-defined-variables}

`SET`ステートメントを使用してユーザー定義変数を設定できます。構文は`SET @var_name = expr [, @var_name = expr] ...;`です。例えば：

```sql
SET @favorite_db = 'TiDB';
```

```sql
SET @a = 'a', @b = 'b', @c = 'c';
```

代入演算子には、 `:=`を使用することもできます。例えば：

```sql
SET @favorite_db := 'TiDB';
```

代入演算子の右側の内容には、任意の有効な式を指定できます。例えば：

```sql
SET @c = @a + @b;
```

```sql
set @c = b'1000001' + b'1000001';
```

## ユーザー定義変数を読み取る {#read-the-user-defined-variables}

ユーザー定義変数を読み取るには、 `SELECT`ステートメントを使用してクエリを実行できます。

```sql
SELECT @a1, @a2, @a3
```

    +------+------+------+
    | @a1  | @a2  | @a3  |
    +------+------+------+
    |    1 |    2 |    4 |
    +------+------+------+

`SELECT`ステートメントで値を割り当てることもできます。

```sql
SELECT @a1, @a2, @a3, @a4 := @a1+@a2+@a3;
```

    +------+------+------+--------------------+
    | @a1  | @a2  | @a3  | @a4 := @a1+@a2+@a3 |
    +------+------+------+--------------------+
    |    1 |    2 |    4 |                  7 |
    +------+------+------+--------------------+

変数`@a4`が変更されるか、接続が閉じられる前は、その値は常に`7`です。

ユーザー定義変数を設定するときに 16 進リテラルまたはバイナリ リテラルが使用される場合、TiDB はそれをバイナリ文字列として扱います。これを数値に設定する場合は、手動で`CAST`変換を追加するか、式で数値演算子を使用します。

```sql
SET @v1 = b'1000001';
SET @v2 = b'1000001'+0;
SET @v3 = CAST(b'1000001' AS UNSIGNED);
```

```sql
SELECT @v1, @v2, @v3;
```

    +------+------+------+
    | @v1  | @v2  | @v3  |
    +------+------+------+
    | A    | 65   | 65   |
    +------+------+------+

初期化されていないユーザー定義変数を参照する場合、その変数の値は NULL で、型は文字列になります。

```sql
SELECT @not_exist;
```

    +------------+
    | @not_exist |
    +------------+
    | NULL       |
    +------------+

ユーザー定義変数を読み取るために`SELECT`ステートメントを使用することに加えて、もう 1 つの一般的な使用法は`PREPARE`ステートメントです。例えば：

```sql
SET @s = 'SELECT SQRT(POW(?,2) + POW(?,2)) AS hypotenuse';
PREPARE stmt FROM @s;
SET @a = 6;
SET @b = 8;
EXECUTE stmt USING @a, @b;
```

    +------------+
    | hypotenuse |
    +------------+
    |         10 |
    +------------+

ユーザー定義変数の内容は、SQL ステートメント内の識別子として認識されません。例えば：

```sql
SELECT * from t;
```

    +---+
    | a |
    +---+
    | 1 |
    +---+

```sql
SET @col = "`a`";
SELECT @col FROM t;
```

    +------+
    | @col |
    +------+
    | `a`  |
    +------+

## MySQLの互換性 {#mysql-compatibility}

`SELECT ... INTO <variable>`を除いて、MySQL と TiDB でサポートされる構文は同じです。

詳細については、 [MySQL のユーザー定義変数](https://dev.mysql.com/doc/refman/8.0/en/user-variables.html)を参照してください。
