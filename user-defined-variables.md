---
title: User-Defined Variables
summary: ユーザー定義変数の使用方法を学習します。
---

# ユーザー定義変数 {#user-defined-variables}

このドキュメントでは、TiDB におけるユーザー定義変数の概念と、ユーザー定義変数を設定および読み取る方法について説明します。

> **警告：**
>
> ユーザー定義変数はまだ実験的機能です。本番環境での使用は推奨され**ません**。

ユーザー定義変数の形式は`@var_name`です。 `var_name`構成する文字は、識別子を構成できる任意の文字（数字`0-9` 、文字`a-zA-Z` 、アンダースコア`_` 、ドル記号`$` 、UTF-8文字など）です。さらに、英語のピリオド`.`も含まれます。ユーザー定義変数は大文字と小文字を区別しません。

ユーザー定義変数はセッション固有であるため、1 つのクライアント接続で定義されたユーザー変数は、他のクライアント接続では表示または使用できません。

## ユーザー定義変数を設定する {#set-the-user-defined-variables}

[`SET`ステートメント](/sql-statements/sql-statement-set-variable.md)使ってユーザー定義変数を設定できます。構文は`SET @var_name = expr [, @var_name = expr] ...;`です。例えば：

```sql
SET @favorite_db = 'TiDB';
```

```sql
SET @a = 'a', @b = 'b', @c = 'c';
```

代入演算子には`:=`も使用できます。例:

```sql
SET @favorite_db := 'TiDB';
```

代入演算子の右側の内容は、任意の有効な式にすることができます。例:

```sql
SET @c = @a + @b;
```

```sql
SET @c = b'1000001' + b'1000001';
```

## ユーザー定義変数を読み取る {#read-the-user-defined-variables}

ユーザー定義変数を読み取るには、 `SELECT`ステートメントを使用してクエリを実行します。

```sql
SELECT @a1, @a2, @a3
```

    +------+------+------+
    | @a1  | @a2  | @a3  |
    +------+------+------+
    |    1 |    2 |    4 |
    +------+------+------+

`SELECT`ステートメントで値を割り当てることもできます。

```sql
SELECT @a1, @a2, @a3, @a4 := @a1+@a2+@a3;
```

    +------+------+------+--------------------+
    | @a1  | @a2  | @a3  | @a4 := @a1+@a2+@a3 |
    +------+------+------+--------------------+
    |    1 |    2 |    4 |                  7 |
    +------+------+------+--------------------+

変数`@a4`が変更される前、または接続が閉じられる前は、その値は常に`7`です。

ユーザー定義変数を設定する際に16進数リテラルまたはバイナリリテラルが使用された場合、TiDBはそれをバイナリ文字列として扱います。数値に設定したい場合は、手動で`CAST`に変換するか、式の中で数値演算子を使用してください。

```sql
SET @v1 = b'1000001';
SET @v2 = b'1000001'+0;
SET @v3 = CAST(b'1000001' AS UNSIGNED);
```

```sql
SELECT @v1, @v2, @v3;
```

    +------+------+------+
    | @v1  | @v2  | @v3  |
    +------+------+------+
    | A    | 65   | 65   |
    +------+------+------+

初期化されていないユーザー定義変数を参照すると、その値は NULL で、型は文字列になります。

```sql
SELECT @not_exist;
```

    +------------+
    | @not_exist |
    +------------+
    | NULL       |
    +------------+

ユーザー定義変数の読み取りには`SELECT`文を使用するほか、 `PREPARE`文もよく使用されます。例えば、次のようになります。

```sql
SET @s = 'SELECT SQRT(POW(?,2) + POW(?,2)) AS hypotenuse';
PREPARE stmt FROM @s;
SET @a = 6;
SET @b = 8;
EXECUTE stmt USING @a, @b;
```

    +------------+
    | hypotenuse |
    +------------+
    |         10 |
    +------------+

ユーザー定義変数の内容は、SQL文では識別子として認識されません。例:

```sql
SELECT * from t;
```

    +---+
    | a |
    +---+
    | 1 |
    +---+

```sql
SET @col = "`a`";
SELECT @col FROM t;
```

    +------+
    | @col |
    +------+
    | `a`  |
    +------+

## MySQLの互換性 {#mysql-compatibility}

`SELECT ... INTO <variable>`を除いて、MySQL と TiDB でサポートされる構文は同一です。

詳細については[MySQLのユーザー定義変数](https://dev.mysql.com/doc/refman/8.0/en/user-variables.html)参照してください。
