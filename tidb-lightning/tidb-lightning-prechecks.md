---
title: TiDB Lightning Prechecks
summary: TiDB Lightningは、移行タスクを実行する前に構成をチェックする機能を提供します。デフォルトで有効になっており、クラスタのバージョン、権限、ディスクスペース、リージョン分布状況、CSVファイルのサイズ、ブレークポイントからの回復、既存のテーブルとターゲットテーブルの状況をチェックします。これにより、インポートプロセス全体がスムーズに進むようにします。
---

# TiDB Lightning事前チェック {#tidb-lightning-prechecks}

TiDB 5.3.0 以降、 TiDB Lightning、移行タスクを実行する前に構成をチェックする機能が提供されています。デフォルトでは有効になっています。この機能は、ディスク容量と実行構成に関するいくつかの日常的なチェックを自動的に実行します。主な目的は、その後のインポート プロセス全体がスムーズに進むようにすることです。

各チェック項目と詳細な説明を次の表に示します。

| チェック項目                | サポートされているバージョン | 説明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| --------------------- | -------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| クラスタのバージョンとステータス      | = 5.3.0        | クラスタが接続できる構成か、TiKV/PD/ TiFlashのバージョンが物理インポートモードをサポートしているかを確認してください。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 権限                    | = 5.3.0        | データソースがクラウドstorage(Amazon S3) の場合、 TiDB Lightning に必要な権限があるかどうかを確認し、権限がないためにインポートが失敗しないことを確認してください。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| ディスクスペース              | = 5.3.0        | ローカル ディスクと TiKV クラスターにデータをインポートするための十分なスペースがあるかどうかを確認します。 TiDB Lightning はデータ ソースをサンプリングし、サンプル結果からインデックス サイズのパーセンテージを推定します。推定にはインデックスが含まれるため、ソース データのサイズがローカル ディスク上の利用可能な領域よりも小さい場合がありますが、それでもチェックは失敗します。物理インポート モードでは、外部並べ替えをローカルで行う必要があるため、 TiDB Lightning はローカルstorageが十分であるかどうかもチェックします。 TiKV クラスター スペースとローカルstorageスペース ( `sort-kv-dir`によって制御される) の詳細については、 [ダウンストリームのstorageスペース要件](/tidb-lightning/tidb-lightning-requirements.md#storage-space-of-the-target-database)および[リソース要件](/tidb-lightning/tidb-lightning-physical-import-mode.md#environment-requirements)を参照してください。 |
| リージョン分布状況             | = 5.3.0        | TiKV クラスター内のリージョンが均等に分散されているかどうか、および空のリージョンが多すぎるかどうかを確認します。空のリージョンの数が max(1000, テーブル数 * 3) を超える場合、つまり「1000」または「テーブル数の 3 倍」の大きい方を超える場合、インポートは実行できません。                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| データファイル内の大きすぎるCSVファイル | = 5.3.0        | バックアップ ファイルに 10 GiB を超える CSV ファイルがあり、自動スライスが有効になっていない (StrictFormat=false) 場合、インポートのパフォーマンスに影響します。このチェックの目的は、データが正しい形式であることを確認し、自動スライスを有効にすることを思い出させることです。                                                                                                                                                                                                                                                                                                                                                                                                                           |
| ブレークポイントからの回復         | = 5.3.0        | このチェックにより、ブレークポイント回復プロセス中に、間違ったデータのインポートにつながるような変更がデータベース内のソース ファイルまたはスキーマに加えられていないことが保証されます。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 既存のテーブルにインポートする       | = 5.3.0        | すでに作成されているテーブルにインポートする場合、ソース ファイルが既存のテーブルと一致するかどうかを可能な限りチェックします。列数が一致しているか確認してください。ソース ファイルに列名がある場合は、列名が一致するかどうかを確認します。ソース ファイルにデフォルトの列がある場合、デフォルトの列にデフォルト値があるかどうかがチェックされ、デフォルト値がある場合はチェックに合格します。                                                                                                                                                                                                                                                                                                                                                                                    |
| ターゲットテーブルが空かどうか       | = 5.3.1        | ターゲットテーブルが空でない場合、 TiDB Lightning はエラーで自動的に終了します。平行輸入モードが有効（ `parallel-import = true` ）の場合、このチェック項目はスキップされます。                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
