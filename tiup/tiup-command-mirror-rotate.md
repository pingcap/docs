---
title: tiup mirror rotate
summary: TiUPミラーローテートは、 TiUPミラー内のroot.jsonファイルを更新するために使用されます。このファイルには公開鍵と有効期限が含まれており、管理者によって署名されています。このコマンドは更新プロセスを自動化し、すべての管理者によるファイルへの署名を要求します。このコマンドを使用する前に、すべてのTiUPクライアントがv1.5.0以降にアップグレードされていることを確認してください。
---

# tiup mirror rotate {#tiup-mirror-rotate}

`root.json`はTiUPミラーにおける重要なファイルです。システム全体に必要な公開鍵が格納され、 TiUPにおける信頼チェーンの基盤となります。主に以下の部分から構成されます。

-   ミラー管理者の署名。公式ミラーの場合、署名は5つあります。初期化されたミラーの場合、デフォルトで署名は3つあります。
-   次のファイルを検証するために使用される公開鍵:
    -   ルート.json
    -   インデックス.json
    -   スナップショット.json
    -   タイムスタンプ.json
-   有効期限は`root.json` 。公式ミラーの場合、有効期限は作成日`root.json`の 1 年後となります。

TiUPミラーの詳細については、 [TiUPミラーリファレンス](/tiup/tiup-mirror-reference.md)参照してください。

以下の場合には`root.json`更新する必要があります。

-   ミラーのキーを交換してください。
-   証明書ファイルの有効期限を更新します。

`root.json`の内容が更新された後、ファイルはすべての管理者によって再署名される必要があります。そうでない場合、クライアントはファイルを拒否します。更新プロセスは以下のとおりです。

1.  ユーザー（クライアント）は`root.json`のコンテンツを更新します。
2.  すべての管理者が新しい`root.json`ファイルに署名します。
3.  tiup-server は`snapshot.json`更新して、新しい`root.json`ファイルのバージョンを記録します。
4.  tiup-server は新しい`snapshot.json`ファイルに署名します。
5.  tiup-server は`timestamp.json`更新して、新しい`snapshot.json`ファイルのハッシュ値を記録します。
6.  tiup-server は新しい`timestamp.json`ファイルに署名します。

TiUP はコマンド`tiup mirror rotate`を使用して上記のプロセスを自動化します。

> **注記：**
>
> -   TiUPバージョン1.5.0より前のバージョンでは、このコマンドを実行しても正しい新しい`root.json`ファイルが返されません[＃983](https://github.com/pingcap/tiup/issues/983)参照してください。
> -   このコマンドを使用する前に、すべてのTiUPクライアントが v1.5.0 以降のバージョンにアップグレードされていることを確認してください。

## 構文 {#syntax}

```shell
tiup mirror rotate [flags]
```

このコマンドを実行すると、 TiUPはエディタを起動し、ユーザーがファイルの内容を目的の値に変更できるようにします。例えば、フィールド`expires`の値を将来の日付に変更します。次に、フィールドTiUP `version`値を`N`から`N+1`に変更し、ファイルを保存します。ファイルの保存後、 TiUPは一時的なHTTPサーバーを起動し、すべてのミラー管理者がファイルに署名するのを待ちます。

ミラー管理者がファイルに署名する方法については、 [`sign`コマンド](/tiup/tiup-command-mirror-sign.md)を参照してください。

## オプション {#options}

### --addr {#addr}

-   一時サーバーのリスニングアドレスを指定します。他のミラー管理者が[`sign`コマンド](/tiup/tiup-command-mirror-sign.md)使用してファイルに署名できるように、このアドレスにアクセスできることを確認する必要があります。
-   データ型: `STRING`
-   コマンドでこのオプションを指定しない場合、 TiUP はデフォルトで`0.0.0.0:8080`でリッスンします。

## 出力 {#outputs}

各ミラー管理者の現在の署名ステータス。

[&lt;&lt; 前のページに戻る - TiUPミラーコマンドリスト](/tiup/tiup-command-mirror.md#command-list)
