---
title: tiup cluster upgrade
summary: tiup cluster upgradeコマンドは、指定したクラスターを特定のバージョンにアップグレードするために使用されます。入力として、クラスター名とターゲットバージョンが必要です。オプションには、エラーを無視してクラスターを起動する--force 、ノード移行の最大待機時間を設定する--transfer-timeout 、構成チェックをスキップする --ignore-config-check、クラスターを再起動せずにバイナリファイルを置き換える--offlineなどがあります。出力はアップグレードの進行状況のログです。
---

# tiup cluster upgrade {#tiup-cluster-upgrade}

`tiup cluster upgrade`コマンドは、指定されたクラスターを特定のバージョンにアップグレードするために使用されます。

## 構文 {#syntax}

```shell
tiup cluster upgrade <cluster-name> <version> [flags]
```

-   `<cluster-name>` : 操作対象のクラスタ名。クラスタ名を忘れた場合は、 [クラスターリスト](/tiup/tiup-component-cluster-list.md)コマンドで確認できます。
-   `<version>` : アップグレード先のバージョン（例： `v8.5.3` ）。現在、現在のクラスターよりも上位のバージョンへのアップグレードのみが許可されており、ダウングレードは許可されていません。また、ナイトリーバージョンへのアップグレードも許可されていません。

## オプション {#options}

### &#x20;--force {#force}

-   クラスターをアップグレードするには、クラスターが現在起動していることを確認する必要があります。場合によっては、クラスターが起動していない状態でアップグレードを実行したい場合があります。その場合は、 `--force`使用すると、アップグレード中のエラーを無視し、バイナリファイルを強制的に置き換えてクラスターを起動できます。
-   データ型: `BOOLEAN`
-   デフォルト: false

> **注記：**
>
> サービスを提供しているクラスターを強制的にアップグレードすると、サービスが利用できなくなる可能性があります。アップグレードが成功すると、起動していないクラスターは自動的に起動されます。

### --transfer-timeout {#transfer-timeout}

-   PDまたはTiKVをアップグレードする場合、アップグレード対象ノードのリーダーノードが最初に他のノードに移行されます。移行プロセスには時間がかかります。1 `-transfer-timeout`で最大待機時間（秒単位）を設定できます。タイムアウト後、待機はスキップされ、サービスは直接アップグレードされます。
-   データ型: `uint`
-   デフォルト: 600

> **注記：**
>
> 待機をスキップしてサービスを直接アップグレードすると、サービスのパフォーマンスが不安定になる可能性があります。

### --ignore-config-check {#ignore-config-check}

-   バイナリの更新後、 `<binary> --config-check <config-file>`使用して TiDB、TiKV、PD コンポーネントの構成チェックが実行されます。3 `<binary>`新しくデプロイされたバイナリへのパス、 `<config-file>`ユーザー設定に基づいて生成された構成ファイルです。このチェックをスキップするには、 `--ignore-config-check`オプションを使用します。
-   データ型: `BOOLEAN`
-   デフォルト: false

### --ignore-version-check {#ignore-version-check}

-   アップグレード前に、 TiUP はターゲットバージョンが現在のバージョン以上であるかどうかを確認します。このチェックを省略するには、オプション`--ignore-version-check`使用します。
-   データ型: `BOOLEAN`
-   このオプションはデフォルトで値`false`で無効になっています。このオプションを有効にするには、コマンドにこのオプションを追加し、値`true`を渡すか、値を渡さないでください。

### &#x20;--offline {#offline}

-   現在のクラスターが実行中でないことを宣言します。このオプションが指定されると、 TiUP はサービスリーダーを別のノードに移動させたり、サービスを再起動したりせず、クラスターコンポーネントのバイナリファイルのみを置き換えます。
-   データ型: `BOOLEAN`
-   このオプションはデフォルトで値`false`で無効になっています。このオプションを有効にするには、コマンドにこのオプションを追加し、値`true`を渡すか、値を渡さないでください。

### --pdバージョン {#pd-version}

-   PDのバージョンを指定します。このオプションを設定すると、PDのバージョンとクラスターのバージョンが一致しなくなります。
-   データ型: `STRINGS`
-   このオプションが設定されていない場合、PD のバージョンはクラスターのバージョンと一致し続けます。

### --tikv バージョン {#tikv-version}

-   TiKVのバージョンを指定します。このオプションを設定すると、TiKVのバージョンはクラスターのバージョンと一致しなくなります。
-   データ型: `STRINGS`
-   このオプションが設定されていない場合、TiKV のバージョンはクラスターのバージョンと一致し続けます。

### --tikv-cdc-バージョン {#tikv-cdc-version}

-   TiKV CDCのバージョンを指定します。このオプションを設定すると、TiKV CDCのバージョンはクラスタのバージョンと一致しなくなります。
-   データ型: `STRINGS`
-   このオプションが設定されていない場合、TiKV CDC のバージョンはクラスターのバージョンと一致し続けます。

### --tiflash-version {#tiflash-version}

-   TiFlashのバージョンを指定します。このオプションを設定すると、 TiFlashのバージョンはクラスターのバージョンと一致しなくなります。
-   データ型: `STRINGS`
-   このオプションが設定されていない場合、 TiFlashのバージョンはクラスターのバージョンと一致したままになります。

### --cdc バージョン {#cdc-version}

-   TiCDCのバージョンを指定します。このオプションを設定すると、TiCDCのバージョンはクラスターのバージョンと一致しなくなります。
-   データ型: `STRINGS`
-   このオプションが設定されていない場合、TiCDC のバージョンはクラスターのバージョンと一致し続けます。

### --tiproxy バージョン {#tiproxy-version}

-   TiProxyのバージョンを指定します。このオプションを設定すると、TiProxyのバージョンはクラスタのバージョンと一致しなくなります。
-   データ型: `STRINGS`
-   このオプションが設定されていない場合、TiProxy のバージョンはクラスターのバージョンと一致したままになります。

### --tidb-ダッシュボードバージョン {#tidb-dashboard-version}

-   TiDBダッシュボードのバージョンを指定します。このオプションを設定すると、TiDBダッシュボードのバージョンはクラスターのバージョンと一致しなくなります。
-   データ型: `STRINGS`
-   このオプションが設定されていない場合、TiDB ダッシュボードのバージョンはクラスターのバージョンと一致したままになります。

### --alertmanager-バージョン {#alertmanager-version}

-   アラートマネージャーのバージョンを指定します。このオプションを設定すると、アラートマネージャーのバージョンはクラスターのバージョンと一致しなくなります。
-   データ型: `STRINGS`
-   このオプションが設定されていない場合、アラート マネージャーのバージョンはクラスターのバージョンと一致したままになります。

### --blackbox-exporter-version {#blackbox-exporter-version}

-   Blackbox Exporterのバージョンを指定します。このオプションを設定すると、Blackbox Exporterのバージョンとクラスタのバージョンが一致しなくなります。
-   データ型: `STRINGS`
-   このオプションが設定されていない場合、Blackbox Exporter のバージョンはクラスターのバージョンと一致したままになります。

### --node-exporter-version {#node-exporter-version}

-   Node Exporterのバージョンを指定します。このオプションを設定すると、Node Exporterのバージョンとクラスターのバージョンが一致しなくなります。
-   データ型: `STRINGS`
-   このオプションが設定されていない場合、Node Exporter のバージョンはクラスターのバージョンと一致したままになります。

### --再起動タイムアウト {#restart-timeout}

-   ローリング アップグレード中にコンポーネントをアップグレードした後の待機時間を指定します。
-   データ型: `STRINGS` [`golang time.ParseDuration`](https://pkg.go.dev/time#ParseDuration)で解析できるすべての型がサポートされます。
-   デフォルト: `0`
-   このオプションを指定しないと、コンポーネントのアップグレード後に待機時間は発生しません。

### -h, --help {#h-help}

-   ヘルプ情報を出力します。
-   データ型: `BOOLEAN`
-   このオプションはデフォルトで値`false`で無効になっています。このオプションを有効にするには、コマンドにこのオプションを追加し、値`true`を渡すか、値を渡さないでください。

### ---アップグレード前スクリプト {#pre-upgrade-script}

> **警告：**
>
> このオプションは実験的であり、本番での展開には推奨されません。

-   アップグレード前にスクリプトを実行します。
-   データ型: `STRINGS`
-   このオプションは、アップグレードするノードで実行されるスクリプトのパスを指定します。

### ---アップグレード後のスクリプト {#post-upgrade-script}

> **警告：**
>
> このオプションは実験的であり、本番での展開には推奨されません。

-   アップグレード後にスクリプトを実行します。
-   データ型: `STRINGS`
-   このオプションは、ノードのアップグレード後に実行されるスクリプトのパスを指定します。このスクリプトは、アップグレードされたノード自体で実行されます。

## 出力 {#output}

アップグレードの進行状況のログ。

[&lt;&lt; 前のページに戻る - TiUPクラスタコマンド リスト](/tiup/tiup-component-cluster.md#command-list)
