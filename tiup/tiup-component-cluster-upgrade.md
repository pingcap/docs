---
title: tiup cluster upgrade
summary: tiup cluster upgradeコマンドは、指定されたクラスターを特定のバージョンにアップグレードするために使用されます。入力として、クラスター名とターゲット バージョンが必要です。オプションには、エラーを無視してクラスターを起動する--force 、ノード移行の最大待機時間を設定する--transfer-timeout 、構成チェックをスキップする --ignore-config-check、クラスターを再起動せずにバイナリ ファイルを置き換える--offlineがあります。出力は、アップグレードの進行状況のログです。
---

# tiup cluster upgrade {#tiup-cluster-upgrade}

`tiup cluster upgrade`コマンドは、指定されたクラスターを特定のバージョンにアップグレードするために使用されます。

## 構文 {#syntax}

```shell
tiup cluster upgrade <cluster-name> <version> [flags]
```

-   `<cluster-name>` : 操作対象のクラスター名。クラスター名を忘れた場合は、 [クラスターリスト](/tiup/tiup-component-cluster-list.md)コマンドで確認できます。
-   `<version>` : アップグレードするターゲットバージョン (例: `v8.1.1` )。現在、現在のクラスターよりも高いバージョンへのアップグレードのみが許可されており、ダウングレードは許可されていません。また、ナイトリーバージョンへのアップグレードも許可されていません。

## オプション {#options}

### &#x20;--force {#force}

-   クラスターをアップグレードするには、クラスターが現在起動していることを確認する必要があります。場合によっては、クラスターが起動していないときにアップグレードする必要があるかもしれません。このとき、 `--force`使用してアップグレード中のエラーを無視し、バイナリ ファイルを強制的に置き換えてクラスターを起動することができます。
-   データ型: `BOOLEAN`
-   デフォルト: false

> **注記：**
>
> サービスを提供しているクラスターのアップグレードを強制すると、サービスが利用できなくなる可能性があります。起動されていないクラスターは、アップグレードが成功すると自動的に起動されます。

### --transfer-timeout {#transfer-timeout}

-   PD または TiKV をアップグレードする場合、アップグレードされたノードのリーダーが最初に他のノードに移行されます。移行プロセスには時間がかかり、 `-transfer-timeout`オプションで最大待機時間 (秒単位) を設定できます。タイムアウト後、待機はスキップされ、サービスは直接アップグレードされます。
-   データ型: `uint`
-   デフォルト: 600

> **注記：**
>
> 待機をスキップしてサービスを直接アップグレードすると、サービスのパフォーマンスが不安定になる可能性があります。

### --設定チェックを無視 {#ignore-config-check}

-   バイナリが更新されると、 `<binary> --config-check <config-file>`使用して TiDB、TiKV、および PD コンポーネントの構成チェックが実行されます。 `<binary>`新しくデプロイされたバイナリへのパスであり、 `<config-file>`ユーザー構成に基づいて生成された構成ファイルです。 このチェックをスキップするには、 `--ignore-config-check`オプションを使用できます。
-   データ型: `BOOLEAN`
-   デフォルト: false

### --バージョンチェックを無視 {#ignore-version-check}

-   アップグレードする前に、 TiUP はターゲット バージョンが現在のバージョン以上であるかどうかを確認します。このチェックをスキップするには、 `--ignore-version-check`オプションを使用できます。
-   データ型: `BOOLEAN`
-   このオプションは、値`false`でデフォルトで無効になっています。このオプションを有効にするには、このオプションをコマンドに追加し、値`true`を渡すか、値を渡さないようにします。

### &#x20;--offline {#offline}

-   現在のクラスターが実行されていないことを宣言します。このオプションを指定すると、 TiUP はサービス リーダーを別のノードに移動したり、サービスを再起動したりせず、クラスター コンポーネントのバイナリ ファイルのみを置き換えます。
-   データ型: `BOOLEAN`
-   このオプションは、値`false`でデフォルトで無効になっています。このオプションを有効にするには、このオプションをコマンドに追加し、値`true`を渡すか、値を渡さないようにします。

### --pdバージョン {#pd-version}

-   PD のバージョンを指定します。このオプションを設定すると、PD のバージョンはクラスターのバージョンと一致しなくなります。
-   データ型: `STRINGS`
-   このオプションが設定されていない場合、PD のバージョンはクラスターのバージョンと一致し続けます。

### --tikv バージョン {#tikv-version}

-   TiKV のバージョンを指定します。このオプションを設定すると、TiKV のバージョンはクラスターのバージョンと一致しなくなります。
-   データ型: `STRINGS`
-   このオプションが設定されていない場合、TiKV のバージョンはクラスターのバージョンと一致し続けます。

### --tikv-cdc バージョン {#tikv-cdc-version}

-   TiKV CDC のバージョンを指定します。このオプションを設定すると、TiKV CDC のバージョンはクラスターのバージョンと一致しなくなります。
-   データ型: `STRINGS`
-   このオプションが設定されていない場合、TiKV CDC のバージョンはクラスターのバージョンと一致し続けます。

### --tiflash バージョン {#tiflash-version}

-   TiFlashのバージョンを指定します。このオプションを設定すると、 TiFlashのバージョンはクラスターのバージョンと一致しなくなります。
-   データ型: `STRINGS`
-   このオプションが設定されていない場合、 TiFlashのバージョンはクラスターのバージョンと一致したままになります。

### --cdc バージョン {#cdc-version}

-   TiCDC のバージョンを指定します。このオプションを設定すると、TiCDC のバージョンはクラスターのバージョンと一致しなくなります。
-   データ型: `STRINGS`
-   このオプションが設定されていない場合、TiCDC のバージョンはクラスターのバージョンと一致し続けます。

### --tiproxy バージョン {#tiproxy-version}

-   TiProxy のバージョンを指定します。このオプションを設定すると、TiProxy のバージョンはクラスターのバージョンと一致しなくなります。
-   データ型: `STRINGS`
-   このオプションが設定されていない場合、TiProxy のバージョンはクラスターのバージョンと一致したままになります。

### --tidb ダッシュボードバージョン {#tidb-dashboard-version}

-   TiDB ダッシュボードのバージョンを指定します。このオプションを設定すると、TiDB ダッシュボードのバージョンはクラスターのバージョンと一致しなくなります。
-   データ型: `STRINGS`
-   このオプションが設定されていない場合、TiDB ダッシュボードのバージョンはクラスターのバージョンと一致し続けます。

### --アラートマネージャバージョン {#alertmanager-version}

-   アラート マネージャーのバージョンを指定します。このオプションを設定すると、アラート マネージャーのバージョンはクラスターのバージョンと一致しなくなります。
-   データ型: `STRINGS`
-   このオプションが設定されていない場合、アラート マネージャーのバージョンはクラスターのバージョンと一致したままになります。

### --blackbox-exporter-version {#blackbox-exporter-version}

-   Blackbox Exporter のバージョンを指定します。このオプションを設定すると、Blackbox Exporter のバージョンはクラスターのバージョンと一致しなくなります。
-   データ型: `STRINGS`
-   このオプションが設定されていない場合、Blackbox Exporter のバージョンはクラスターのバージョンと一致したままになります。

### --node-exporter-version {#node-exporter-version}

-   Node Exporter のバージョンを指定します。このオプションを設定すると、Node Exporter のバージョンはクラスターのバージョンと一致しなくなります。
-   データ型: `STRINGS`
-   このオプションが設定されていない場合、Node Exporter のバージョンはクラスターのバージョンと一致し続けます。

### -h, --help {#h-help}

-   ヘルプ情報を出力します。
-   データ型: `BOOLEAN`
-   このオプションは、値`false`でデフォルトで無効になっています。このオプションを有効にするには、このオプションをコマンドに追加し、値`true`を渡すか、値を渡さないようにします。

### ---アップグレード前のスクリプト {#pre-upgrade-script}

> **警告：**
>
> このオプションは実験的であり、本番での展開には推奨されません。

-   アップグレード前にスクリプトを実行します。
-   データ型: `STRINGS`
-   このオプションは、アップグレードするノードで実行されるスクリプトのパスを指定します。

### ---アップグレード後のスクリプト {#post-upgrade-script}

> **警告：**
>
> このオプションは実験的であり、本番での展開には推奨されません。

-   アップグレード後にスクリプトを実行します。
-   データ型: `STRINGS`
-   このオプションは、ノードのアップグレード後に実行されるスクリプトのパスを指定します。このスクリプトは、アップグレードされたノード自体で実行されます。

## 出力 {#output}

アップグレードの進行状況のログ。

[&lt;&lt; 前のページに戻る - TiUPクラスタコマンド リスト](/tiup/tiup-component-cluster.md#command-list)
