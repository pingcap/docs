---
title: tiup cluster scale-in
---

# tiup cluster scale-in {#tiup-cluster-scale-in}

`tiup cluster scale-in`コマンドはクラスターのスケールインに使用されます。これにより、指定されたノードのサービスがオフラインになり、指定されたノードがクラスターから削除され、残りのファイルがそれらのノードから削除されます。

## コンポーネントのオフラインプロセスの特別な処理 {#particular-handling-of-components-offline-process}

TiKV、 TiFlash、および TiDB Binlogコンポーネントは非同期的にオフラインになり ( TiUP が最初に API を介してノードを削除する必要がある)、停止プロセスに時間がかかるため (ノードが正常にオフラインになったかどうかをTiUPが継続的に確認する必要がある)、 TiKV、 TiFlash、および TiDB Binlogコンポーネントは、特に次のように処理されます。

-   TiKV、 TiFlash、および TiDB Binlogコンポーネントの場合:

    1.  TiUPクラスタはAPI を通じてノードをオフラインにし、プロセスの完了を待たずに直接終了します。
    2.  スケールイン中のノードのステータスを確認するには、 `tiup cluster display`コマンドを実行し、ステータスが`Tombstone`になるまで待つ必要があります。
    3.  `Tombstone`状態のノードをクリーンアップするには、 `tiup cluster prune`コマンドを実行する必要があります。 `tiup cluster prune`コマンドは次の操作を実行します。

        -   オフラインになったノードのサービスを停止します。
        -   オフラインになったノードのデータ ファイルをクリーンアップします。
        -   クラスター トポロジを更新し、オフラインになったノードを削除します。

他のコンポーネントの場合:

-   PD コンポーネントをオフラインにすると、 TiUP クラスタ はAPI を通じて指定されたノードをクラスターから迅速に削除し、指定された PD ノードのサービスを停止してから、関連するデータ ファイルをノードから削除します。
-   他のコンポーネントを停止すると、 TiUPクラスタはノード サービスを直接停止し、指定されたノードから関連データ ファイルを削除します。

## 構文 {#syntax}

```shell
tiup cluster scale-in <cluster-name> [flags]
```

`<cluster-name>`は、スケールインするクラスターの名前です。クラスター名を忘れた場合は、 [`tiup cluster list`](/tiup/tiup-component-cluster-list.md)コマンドを使用して確認できます。

## オプション {#options}

### -N、--node {#n-node}

-   削除するノードを指定します。複数のノードはカンマで区切られます。
-   データ型: `STRING`
-   デフォルト値はありません。このオプションは必須であり、値は null であってはなりません。

### &#x20;--force {#force}

-   指定したノードをクラスターから強制的に削除するかどうかを制御します。場合によっては、オフラインにするノードのホストがダウンし、操作のために SSH 経由でノードに接続できなくなることがあります。そのため、 `--force`オプションを使用してクラスターからノードを強制的に削除できます。
-   データ型: `BOOLEAN`
-   このオプションは、値`false`を指定するとデフォルトで無効になります。このオプションを有効にするには、このオプションをコマンドに追加し、値`true`渡すか、値を渡しません。

> **警告：**
>
> このオプションを使用して、サービス中またはオフライン保留中の TiKV ノードまたはTiFlashノードを強制的に削除すると、これらのノードはデータの移行を待たずにすぐに削除されます。これにより、データ損失の非常に高いリスクが生じます。メタデータが存在するリージョンでデータ損失が発生した場合、クラスター全体が使用できなくなり、回復できなくなります。

### --transfer-timeout {#transfer-timeout}

-   PD または TiKV ノードが削除される場合、最初にノード上のリージョンリーダーが別のノードに転送されます。転送プロセスには時間がかかるため、 `--transfer-timeout`を設定することで最大待機時間 (秒単位) を設定できます。タイムアウト後、 `tiup cluster scale-in`コマンドは待機をスキップし、スケールインを直接開始します。
-   データ型: `UINT`
-   このオプションはデフォルトで有効になり、 `600`秒 (デフォルト値) が渡されます。

> **注記：**
>
> リーダー転送の完了を待たずに、PD または TiKV ノードが直接オフラインになると、サービスのパフォーマンスが不安定になる可能性があります。

### -h, --help {#h-help}

-   ヘルプ情報を印刷します。
-   データ型: `BOOLEAN`
-   このオプションは、値`false`を指定するとデフォルトで無効になります。このオプションを有効にするには、このオプションをコマンドに追加し、値`true`渡すか、値を渡しません。

## 出力 {#output}

スケールインプロセスのログを表示します。

[&lt;&lt; 前のページに戻る - TiUPクラスタコマンド リスト](/tiup/tiup-component-cluster.md#command-list)
