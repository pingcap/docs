---
title: tiup cluster scale-in
summary: tiup cluster scale-in` コマンドは、指定されたノードをオフラインにしてクラスターから削除し、残りのファイルを削除することで、クラスターをスケールインするために使用されます。TiKV やTiFlashなどのコンポーネントは非同期で処理され、チェックとクリーンアップのための追加の手順が必要です。このコマンドには、ノードの指定、強制削除、転送タイムアウト、ヘルプ情報のオプションも含まれています。
---

# tiup cluster scale-in {#tiup-cluster-scale-in}

`tiup cluster scale-in`コマンドはクラスターをスケールインするために使用され、指定されたノードのサービスをオフラインにし、指定されたノードをクラスターから削除し、それらのノードから残りのファイルを削除します。

## コンポーネントのオフラインプロセスの特別な処理 {#particular-handling-of-components-offline-process}

TiKV およびTiFlashコンポーネントは非同期的にオフラインになるため (最初にTiUP がAPI を介してノードを削除する必要がある)、停止プロセスには長い時間がかかる (ノードが正常にオフラインになったかどうかをTiUP が継続的に確認する必要がある) ため、TiKV およびTiFlashコンポーネントは特に次のように処理されます。

-   TiKV およびTiFlashコンポーネントの場合:

    1.  TiUP クラスタ はAPI を介してノードをオフラインにし、プロセスが完了するのを待たずにすぐに終了します。
    2.  スケールインされているノードのステータスを確認するには、 `tiup cluster display`コマンドを実行し、ステータスが`Tombstone`になるまで待つ必要があります。
    3.  `Tombstone`ステータスのノードをクリーンアップするには、 `tiup cluster prune`コマンドを実行する必要があります。5 コマンド`tiup cluster prune`次の操作を実行します。

        -   オフラインになったノードのサービスを停止します。
        -   オフラインになったノードのデータ ファイルをクリーンアップします。
        -   クラスター トポロジを更新し、オフラインになったノードを削除します。

その他のコンポーネントの場合:

-   PD コンポーネントをオフラインにする場合、 TiUP クラスタ はAPI を介して指定されたノードをクラスターからすばやく削除し、指定された PD ノードのサービスを停止し、ノードから関連するデータ ファイルを削除します。
-   他のコンポーネントを停止する場合、 TiUP クラスタ はノード サービスを直接停止し、指定されたノードから関連するデータ ファイルを削除します。

## 構文 {#syntax}

```shell
tiup cluster scale-in <cluster-name> [flags]
```

`<cluster-name>`スケールインするクラスターの名前です。クラスター名を忘れた場合は、 [`tiup cluster list`](/tiup/tiup-component-cluster-list.md)コマンドを使用して確認できます。

## オプション {#options}

### -N、--ノード {#n-node}

-   停止するノードを指定します。複数のノードはカンマで区切られます。
-   データ型: `STRING`
-   デフォルト値はありません。このオプションは必須であり、値は null であってはなりません。

### &#x20;--force {#force}

-   指定されたノードをクラスターから強制的に削除するかどうかを制御します。オフラインにするノードのホストがダウンしている場合があり、その場合は SSH 経由でノードに接続して操作を行うことができません。その場合は、 `--force`オプションを使用してクラスターからノードを強制的に削除できます。
-   データ型: `BOOLEAN`
-   このオプションは、値`false`でデフォルトで無効になっています。このオプションを有効にするには、このオプションをコマンドに追加し、値`true`を渡すか、値を渡さないようにします。

> **警告：**
>
> このオプションを使用して、稼働中またはオフライン保留中の TiKV またはTiFlashノードを強制的に削除すると、これらのノードはデータの移行を待たずに直ちに削除されます。これにより、データ損失のリスクが非常に高くなります。メタデータが配置されている領域でデータ損失が発生すると、クラスター全体が使用できなくなり、回復できなくなります。

### --transfer-timeout {#transfer-timeout}

-   PD または TiKV ノードを削除する場合、そのノードのリージョンリーダーは最初に別のノードに転送されます。転送プロセスには時間がかかるため、 `--transfer-timeout`設定して最大待機時間 (秒単位) を設定できます。タイムアウト後、 `tiup cluster scale-in`コマンドは待機をスキップし、直接スケールインを開始します。
-   データ型: `UINT`
-   このオプションはデフォルトで有効になっており、 `600`秒 (デフォルト値) が渡されます。

> **注記：**
>
> リーダー転送が完了するのを待たずに PD ノードまたは TiKV ノードが直接オフラインになると、サービス パフォーマンスが不安定になる可能性があります。

### -h, --help {#h-help}

-   ヘルプ情報を出力します。
-   データ型: `BOOLEAN`
-   このオプションは、値`false`でデフォルトで無効になっています。このオプションを有効にするには、このオプションをコマンドに追加し、値`true`を渡すか、値を渡さないようにします。

## 出力 {#output}

スケールイン プロセスのログを表示します。

[&lt;&lt; 前のページに戻る - TiUPクラスタコマンド リスト](/tiup/tiup-component-cluster.md#command-list)
