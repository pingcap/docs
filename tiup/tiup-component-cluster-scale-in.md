---
title: tiup cluster scale-in
---

# tiup cluster scale-in {#tiup-cluster-scale-in}

`tiup cluster scale-in`コマンドは、クラスタでスケーリングするために使用されます。これにより、指定されたノードのサービスがオフラインになり、指定されたノードがクラスタから削除され、残りのファイルがそれらのノードから削除されます。

## コンポーネントのオフラインプロセスの特定の処理 {#particular-handling-of-components-offline-process}

TiKV、TiFlash、およびTiDB Binlogコンポーネントは非同期でオフラインになり（TiUPは最初にAPIを介してノードを削除する必要があります）、停止プロセスには長い時間がかかります（TiUPはノードが正常にオフラインになるかどうかを継続的にチェックする必要があります）。 TiKV、TiFlash、およびTiDB Binlogコンポーネントは、特に次のように処理されます。

-   TiKV、TiFlash、およびTiDB Binlogコンポーネントの場合：

    1.  TiUP Clusterは、APIを介してノードをオフラインにし、プロセスが完了するのを待たずに直接終了します。
    2.  スケールインされているノードのステータスを確認するには、 `tiup cluster display`コマンドを実行し、ステータスが`Tombstone`になるのを待つ必要があります。
    3.  `Tombstone`ステータスのノードをクリーンアップするには、 `tiup cluster prune`コマンドを実行する必要があります。 `tiup cluster prune`コマンドは、次の操作を実行します。

        -   オフラインにされたノードのサービスを停止します。
        -   オフラインにされたノードのデータファイルをクリーンアップします。
        -   クラスタトポロジを更新し、オフラインにされたノードを削除します。

その他のコンポーネントの場合：

-   PDコンポーネントをオフラインにすると、TiUPクラスターはAPIを介してクラスタから指定されたノードをすばやく削除し、指定されたPDノードのサービスを停止してから、ノードから関連データファイルを削除します。
-   他のコンポーネントを停止すると、TiUPクラスターはノードサービスを直接停止し、指定されたノードから関連データファイルを削除します。

## 構文 {#syntax}

```shell
tiup cluster scale-in <cluster-name> [flags]
```

`<cluster-name>`は、スケールインするクラスタの名前です。クラスタ名を忘れた場合は、 [`tiup cluster list`](/tiup/tiup-component-cluster-list.md)コマンドを使用して確認できます。

## オプション {#options}

### -N、-node {#n-node}

-   停止するノードを指定します。複数のノードはコンマで区切られます。
-   データ型： `STRING`
-   デフォルト値はありません。このオプションは必須であり、値はnullであってはなりません。

### &#x20;--force {#force}

-   指定したノードをクラスタから強制的に削除するかどうかを制御します。オフラインにするノードのホストがダウンしている場合があり、SSH経由でノードに接続して操作できないため、 `-force`オプションを使用してクラスタからノードを強制的に削除できます。
-   データ型： `BOOLEAN`
-   このオプションは、デフォルトで`false`の値で無効になっています。このオプションを有効にするには、このオプションをコマンドに追加し、 `true`の値を渡すか、値を渡さないようにします。

> **警告：**
>
> このオプションを使用して、稼働中またはオフラインで保留中のTiKVまたはTiFlashノードを強制的に削除すると、これらのノードはデータの移行を待たずにすぐに削除されます。これにより、データが失われるリスクが高くなります。したがって、このオプションはダウンノードでのみ使用することをお勧めします。

### --transfer-timeout {#transfer-timeout}

-   PDまたはTiKVノードを削除する場合、ノードのリージョンリーダーが最初に別のノードに転送されます。転送には時間がかかるため、 `--transfer-timeout`を設定することで最大待機時間（秒単位）を設定できます。タイムアウト後、 `tiup cluster scale-in`コマンドは待機をスキップし、直接スケールインを開始します。
-   データ型： `UINT`
-   このオプションはデフォルトで有効になっており、 `300`秒（デフォルト値）が渡されます。

> **ノート：**
>
> リーダーの転送が完了するのを待たずにPDまたはTiKVノードを直接オフラインにすると、サービスのパフォーマンスが低下する可能性があります。

### -h、-help {#h-help}

-   ヘルプ情報を出力します。
-   データ型： `BOOLEAN`
-   このオプションは、デフォルトで`false`の値で無効になっています。このオプションを有効にするには、このオプションをコマンドに追加し、 `true`の値を渡すか、値を渡さないようにします。

## 出力 {#output}

スケールインプロセスのログを表示します。

[&lt;&lt;前のページに戻る-TiUPクラスターコマンドリスト](/tiup/tiup-component-cluster.md#command-list)
