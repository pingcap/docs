---
title: TiDB 2.1 Beta Release Notes
summary: TiDB 2.1ベータリリースには、安定性、SQLオプティマイザー、統計情報、実行エンジンの改善が含まれています。MySQL構文のサポートが拡大し、メモリ使用量が削減され、DDLおよびDML文が最適化されています。PDはRaft PreVoteの有効化、スケジューラー問題の最適化、メトリクスの追加を行いました。TiKVはRustのアップグレード、メトリクスの追加、パフォーマンスの向上を行いました。互換性に関する注意事項として、新バージョンではv2.0.xへのロールバックがサポートされないこと、およびRaft Learnerがデフォルトで有効化されることなどが挙げられます。
---

# TiDB 2.1 ベータ版リリースノート {#tidb-2-1-beta-release-notes}

2018 年 6 月 29 日に、TiDB 2.1 ベータ版がリリースされました。TiDB 2.0 と比較して、このリリースでは安定性、SQL オプティマイザー、統計情報、実行エンジンが大幅に改善されています。

## TiDB {#tidb}

-   SQLオプティマイザー
    -   実行パフォーマンスを向上させるために、選択範囲`Index Join`を最適化します。
    -   相関サブクエリを最適化し、 `Filter`プッシュダウンし、インデックス範囲を拡張して、一部のクエリの効率を桁違いに向上させます。
    -   `UPDATE`と`DELETE`ステートメントの`Index Hint`と`Join Hint`を支持する
    -   利用可能なインデックスが存在しない場合にヒント`TIDM_SMJ`検証する
    -   `ABS` `CEIL` `IS TRUE` `FLOOR`ダウン`IS FALSE`関数
    -   特に定数の折り畳み処理で`IF`と`IFNULL`関数を処理する
-   SQL実行エンジン
    -   並列`Hash Aggregate`演算子を実装し、いくつかのシナリオで`Hash Aggregate`の計算パフォーマンスを350％向上させます。
    -   並列`Project`演算子を実装し、いくつかのシナリオでパフォーマンスを74％向上
    -   実行パフォーマンスを向上させるために、 `Hash Join`のテーブルのうち`Inner`のテーブルと`Outer`テーブルを同時に読み取ります。
    -   いくつかのシナリオで`INSERT … ON DUPLICATE KEY UPDATE …`の誤った結果を修正しました
    -   組み込み関数`CONCAT_WS` 、 `FLOOR` 、 `CEIL` 、 `DIV`の誤った結果を修正しました
-   サーバ
    -   HTTP APIを追加して、TiKVクラスタ内のテーブルリージョンの分散を分散します。
    -   自動`Analyze`のしきい値を制御するための`auto_analyze_ratio`システム変数を追加します
    -   一般ログを開くかどうかを制御するHTTP APIを追加します
    -   ログレベルをオンラインで変更するためのHTTP APIを追加します
    -   一般ログとスロークエリログにユーザー情報を追加する
    -   サーバー側カーソルをサポート
-   互換性
    -   より多くのMySQL構文をサポート
    -   `bit`集計関数が`ALL`パラメータをサポートするようにする
    -   `SHOW PRIVILEGES`声明を支持する
-   DML
    -   `INSERT INTO SELECT`文目のメモリ使用量を減らす
    -   `PlanCache`のパフォーマンス問題を修正
    -   トランザクションの自動再試行回数を制御するためのシステム変数`tidb_retry_limit`追加します
    -   トランザクションが自動的に試行されるかどうかを制御する`tidb_disable_txn_auto_retry`システム変数を追加します。
    -   `time`タイプの書き込まれたデータの精度の問題を修正
    -   競合トランザクションのパフォーマンスを最適化するために、ローカルで競合したトランザクションのキューをサポートします。
    -   `UPDATE`ステートメントのうち`Affected Rows`を修正
    -   `insert ignore on duplicate key update`のステートメントパフォーマンスを最適化する
-   DDL
    -   `CreateTable`文の実行速度を最適化する
    -   `ADD INDEX`の実行速度を最適化し、いくつかのシナリオで大幅に改善しました
    -   追加された列の数が`Alter table add column`つでテーブル列数の制限を超える問題を修正しました
    -   DDLジョブの再試行により異常な状況でTiKVへの負荷が増大する問題を修正しました
    -   異常な状況で TiDB がスキーマ情報を継続的に再ロードする問題を修正しました
    -   `SHOW CREATE TABLE`結果の`FOREIGN KEY`関連情報を出力しない
    -   TiDBが`DDL Owner`であるかどうかの判断を容易にするために`select tidb_is_ddl_owner()`ステートメントをサポートする
    -   一部のシナリオで`Year`タイプのインデックスが削除される問題を修正
    -   同時実行シナリオにおけるテーブル名の変更の問題を修正
    -   `AlterTableForce`構文をサポートする
    -   `AlterTableRenameIndex`構文を`FromKey`と`ToKey`でサポートする
    -   `admin show ddl jobs`の出力情報にテーブル名とデータベース名を追加します

## PD {#pd}

-   ネットワーク分離後にネットワークが回復したときにリーダーの再選出を回避するために、PDノード間でRaft PreVoteを有効にする
-   Balance Scheduler が小さなリージョンを頻繁にスケジュールする問題を最適化します。
-   ホットスポットスケジューラを最適化し、トラフィック統計情報のジッタに対する適応性を向上させます。
-   スケジュール`region merge`ときに行数の多い領域をスキップする
-   スケジュール中にマシン障害によってデータが利用できなくなるリスクを軽減するために、デフォルトで`raft learner`有効にします。
-   `pd-recover`から`max-replica`取り除く
-   `Filter`指標を追加
-   tikv-ctl unsafe リカバリ後にリージョン情報が更新されない問題を修正しました
-   一部のシナリオでレプリカの移行によって TiKV ディスク領域が使い果たされる問題を修正しました
-   互換性に関する注意事項
    -   新しいバージョンのstorageエンジンの更新により、v2.0.x 以前へのロールバックはサポートされません。
    -   新しいバージョンのPDでは、デフォルトで`raft learner`が有効になっています。クラスタを1.xから2.1にアップグレードする場合は、アップグレード前にマシンを停止するか、最初にTiKVにローリングアップデートを適用してからPDを適用する必要があります。

## TiKV {#tikv}

-   Rustをバージョン`nightly-2018-06-14`にアップグレードする
-   `Raft PreVote`有効にすると、ネットワーク分離後にネットワークが回復したときに生成されるリーダーの再選出を回避します。
-   RocksDBの各レイヤーのファイル数と関連情報`ingest`表示するメトリックを追加します。
-   GC が機能しているときにバージョンが多すぎると`key`印刷する
-   `static metric`使用してマルチラベルメトリックのパフォーマンスを最適化します（YCSB `raw get` 3％向上します）
-   複数のモジュールから`box`削除し、パターンを使用して動作パフォーマンスを改善します（YCSB `raw get` 3％向上します）
-   `asynchronous log`使用するとログの書き込みパフォーマンスが向上します
-   スレッドのステータスを収集するためのメトリックを追加する
-   アプリケーションで使用される`box`を減らすことでメモリコピー回数を減らし、パフォーマンスを向上させます
