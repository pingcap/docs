---
title: Back Up and Restore RawKV
summary: Learn how to back up and restore RawKV using BR.
---

# RawKVのバックアップと復元 {#back-up-and-restore-rawkv}

Backup＆Restore（BR）は、特にRawKV（TiKVおよびPDで使用される）のバックアップと復元をサポートします。このドキュメントでは、RawKVをバックアップおよび復元する方法について説明します。

> **警告：**
>
> この機能は、徹底的にテストされていないが、実験中です。実稼働環境で使用することはお勧めし**ません**。

## RawKVをバックアップする {#back-up-rawkv}

一部のシナリオでは、TiKVはTiDBとは独立して実行される場合があります。そのため、BRはTiDBレイヤーのバイパスとTiKVでのデータのバックアップをサポートしています。

{{< copyable "" >}}

```shell
br backup raw --pd $PD_ADDR \
    -s "local://$BACKUP_DIR" \
    --start 31 \
    --ratelimit 128 \
    --end 3130303030303030 \
    --format hex \
    --cf default
```

上記のコマンドは、デフォルトのCFの`[0x31, 0x3130303030303030)`から`$BACKUP_DIR`までのすべてのキーをバックアップします。

このコマンドでは、 `--start`と`--end`の値は、TiKVに送信される前に、 `--format`で指定された形式を使用してデコードされます。現在、次の形式を使用できます。

-   &quot;raw&quot;：入力文字列はバイナリ形式のキーとして直接エンコードされます。
-   「hex」：デフォルトのエンコード形式。入力文字列は16進数として扱われます。
-   &quot;escaped&quot;：最初に入力文字列をエスケープ（バックスラッシュ）してから、バイナリ形式（たとえば、 `abc\xFF\x00\r\n` ）にエンコードします。

> **ノート：**
>
> -   ローカルストレージを使用する場合は、すべてのバックアップSSTファイルを`--storage`で指定されたパスのすべてのTiKVノードにコピーする**必要があり**ます。各TiKVノードが最終的にSSTファイルの一部を読み取るだけでよい場合でも、次の理由により、すべてのノードが完全なアーカイブに完全にアクセスできる必要があります。
>
>     -   データは複数のピアに複製されます。 SSTを取り込む場合、これらのファイルはすべてのピアに存在する必要があります。これは、単一ノードからの読み取りで十分なバックアップとは異なります。
>     -   復元中に各ピアが分散する場所はランダムです。どのノードがどのファイルを読み取るかは事前にわかりません。
> -   これらは、共有ストレージを使用して回避できます。たとえば、ローカルパスにNFSをマウントしたり、S3を使用したりできます。ネットワークストレージを使用すると、すべてのノードがすべてのSSTファイルを自動的に読み取ることができます。この場合、前述の警告は適用されなくなります。
> -   また、1つのクラスタに対して同時に実行できる復元操作は1つだけであることに注意してください。そうしないと、予期しない動作が発生する可能性があります。詳細については、 [よくある質問](/br/backup-and-restore-faq.md#can-i-use-multiple-br-processes-at-the-same-time-to-restore-the-data-of-a-single-cluster)を参照してください。

## RawKVを復元する {#restore-rawkv}

[RawKVのバックアップ](#back-up-rawkv)と同様に、次のコマンドを実行してRawKVを復元できます。

{{< copyable "" >}}

```shell
br restore raw --pd $PD_ADDR \
    -s "local://$BACKUP_DIR" \
    --start 31 \
    --end 3130303030303030 \
    --ratelimit 128 \
    --format hex \
    --cf default
```

この例では、範囲`[0x31, 0x3130303030303030)`のすべてのバックアップされたキーがTiKVクラスタに復元されます。これらのキーのコーディング形式は、バックアッププロセス中のキーのコーディング形式と同じです。
