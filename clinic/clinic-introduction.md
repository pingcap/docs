---
title: PingCAP Clinic Overview
summary: PingCAPクリニックは、TiUPまたはTiDB Operatorを使用して展開されたTiDBクラスターに対する診断サービスです。クラスターの問題をリモートでトラブルシューティングし、ステータスを簡単に確認できます。Diagクライアントは診断データを収集し、クリニックサーバーはデータの保存、表示、診断レポートの提供を行います。クラスターの問題を迅速にトラブルシューティングし、潜在的な問題を予測し、安定した動作を保証します。
---

# PingCAPクリニックの概要 {#pingcap-clinic-overview}

PingCAPクリニック診断サービス (PingCAPクリニック) は、 TiUPまたはTiDB Operatorを使用して展開された TiDB クラスターに対して PingCAP によって提供される診断サービスです。このサービスは、クラスターの問題をリモートでトラブルシューティングするのに役立ち、クラスターのステータスをローカルで簡単に確認できます。 PingCAPクリニックを使用すると、TiDB クラスターのライフサイクル全体にわたって安定した動作を保証し、潜在的な問題を予測し、問題の可能性を低減し、クラスターの問題を迅速にトラブルシューティングし、クラスターの問題を修正できます。

PingCAPクリニック は、クラスターの問題を診断するために次の 2 つのコンポーネントを提供します。

-   [クライアントを診断する](https://github.com/pingcap/diag) :

    Diag クライアント (Diag) は、クラスター側にデプロイされるオープンソースの診断ツールです。 Diag は、クラスター診断データを収集し、診断データをクリニック サーバーにアップロードし、クラスター上でローカルに簡単なヘルス チェックを実行するために使用されます。 Diag によって収集できる診断データの完全なリストについては、 [PingCAPクリニックの診断データ](/clinic/clinic-data-instruction-for-tiup.md)を参照してください。

    > **注記：**
    >
    > Diag は TiDB v4.0 以降のバージョンをサポートしていますが、TiDB Ansible を使用してデプロイされたクラスターからのデータ収集は**サポートしていません**。

-   クリニックサーバー:

    Clinic Server は、クラウド上に展開されるクラウド サービスです。 SaaS モデルで診断サービスを提供することにより、クリニック サーバーはアップロードされた診断データを受信するだけでなく、データの保存、表示、クラスター診断レポートの提供を行うオンライン診断環境としても機能します。 Clinic Server は、storage場所に応じて 2 つの独立したサービスを提供します。

    -   [海外ユーザー向けクリニックサーバー](https://clinic.pingcap.com) : データは米国の AWS に保存されます。
    -   [中国本土のユーザー向けクリニックサーバー](https://clinic.pingcap.com.cn) : データは中国 (北京) リージョンの AWS に保存されます。

## ユーザーシナリオ {#user-scenarios}

-   クラスターの問題をリモートでトラブルシューティングする

    クラスターにすぐに修正できない問題がある場合は、PingCAP またはコミュニティから[支持を得ます](/support.md)できます。リモート アシスタンスについてテクニカル サポートに問い合わせる場合は、クラスターからさまざまな診断データを保存し、そのデータをサポート スタッフに転送する必要があります。この場合、Diag を使用すると、ワンクリックで診断データを収集できます。 Diag を使用すると、完全な診断データを迅速に収集できるため、複雑な手動データ収集操作を回避できます。データを収集した後、PingCAP テクニカル サポート スタッフがクラスターの問題をトラブルシューティングできるように、そのデータをクリニック サーバーにアップロードできます。 Clinic Server は、アップロードされた診断データ用の安全なstorageを提供し、オンライン診断をサポートするため、トラブルシューティングの効率が大幅に向上します。

-   クラスターのステータスをすばやく確認する

    現時点ではクラスターが安定して実行されている場合でも、潜在的な安定性リスクを検出するためにクラスターを定期的にチェックする必要があります。 PingCAPクリニックが提供するローカルおよびサーバー側のクイック チェック機能を使用して、クラスターの潜在的な健全性リスクを特定できます。

## 実装原則 {#implementation-principles}

このセクションでは、Diag がクラスターから診断データを収集する方法に関する実装原則を紹介します。

まず、Diag は、デプロイメント ツールTiUP (tiup-cluster) またはTiDB Operator (tidb-operator) からクラスター トポロジー情報を取得します。次に、Diag は、次のようなさまざまなデータ収集方法を通じて、さまざまな種類の診断データを収集します。

-   SCP を介してサーバーファイルを転送する

    TiUPを使用してデプロイされたクラスターの場合、Diag はセキュリティコピー プロトコル (SCP) を通じてターゲットコンポーネントのノードからログ ファイルと構成ファイルを直接収集できます。

-   SSH を介してリモートでコマンドを実行してデータを収集する

    TiUPを使用してデプロイされたクラスターの場合、Diag は SSH (セキュリティシェル) 経由でターゲットコンポーネントシステムに接続し、コマンド (Insight など) を実行して、カーネル ログ、カーネル パラメーター、システムとハードウェアの基本情報などのシステム情報を取得できます。

-   HTTP 呼び出しを通じてデータを収集する

    -   TiDB コンポーネントの HTTP インターフェイスを呼び出すことにより、Diag は、TiDB、TiKV、PD、およびその他のコンポーネントのリアルタイムの構成サンプリング情報とリアルタイムのパフォーマンス サンプリング情報を取得できます。
    -   Prometheus の HTTP インターフェイスを呼び出すことで、Diag はアラート情報とモニタリング メトリクス データを取得できます。

-   SQL ステートメントを使用してデータベース パラメーターをクエリする

    SQL ステートメントを使用して、Diag は TiDB のシステム変数やその他の情報をクエリできます。この方法を使用するには、データ収集時に TiDB にアクセスするためのユーザー名とパスワードを**追加で提供する**必要があります。

## クリニックサーバーの制限 {#the-limitations-of-clinic-server}

> **注記：**
>
> -   Clinic Server は、2022 年 7 月 15 日から 2024 年 7 月 14 日まで無料です。その後サービスで料金の請求が開始される場合は、2024 年 7 月 14 日までに電子メールで通知されます。
> -   使用制限を調整したい場合は、PingCAP から[支持を得ます](/support.md) 。

| サービスの種類       | 制限          |
| :------------ | :---------- |
| クラスターの数       | 10/組織       |
| ストレージ容量       | 50 GB/クラスター |
| 保存期間          | 180日        |
| データサイズ        | 3 GB/パッケージ  |
| データ再構築環境の保存期間 | 3日          |

## 次のステップ {#next-step}

-   オンプレミス環境でPingCAPクリニックを使用する
    -   [PingCAPクリニックのクイック スタート](/clinic/quick-start-with-clinic.md)
    -   [PingCAPクリニックを使用したクラスターのトラブルシューティング](/clinic/clinic-user-guide-for-tiup.md)
    -   [PingCAPクリニックの診断データ](/clinic/clinic-data-instruction-for-tiup.md)

-   Kubernetes でPingCAPクリニックを使用する
    -   [PingCAPクリニックを使用した TiDBクラスタのトラブルシューティング](https://docs.pingcap.com/tidb-in-kubernetes/stable/clinic-user-guide)
    -   [PingCAPクリニックの診断データ](https://docs.pingcap.com/tidb-in-kubernetes/stable/clinic-data-collection)
