---
title: PingCAP Clinic Overview
summary: PingCAPクリニックは、 TiUPまたはTiDB Operatorを使用して導入されたTiDBクラスタ向けの診断サービスです。クラスタの問題をリモートでトラブルシューティングし、安定した運用を保証し、クラスタの状態を迅速に確認できます。このサービスには、データ収集用のDiagクライアントと、オンライン診断レポート用のClinic Serverが含まれています。ユーザーはリモートで問題をトラブルシューティングし、クラスタの状態を迅速に確認できます。Diagはさまざまな方法で診断データを収集しますが、Clinic Serverにはクラスタ、storage、およびデータサイズに制限があります。このサービスは2025年4月15日まで無料でご利用いただけます。今後の展開としては、 PingCAPクリニックをさまざまな環境で活用していく予定です。
---

# PingCAPクリニックの概要 {#pingcap-clinic-overview}

PingCAPクリニック診断サービス（PingCAPクリニック）は、 TiUPまたはTiDB Operatorを使用して導入されたTiDBクラスタ向けにPingCAPが提供する診断サービスです。このサービスは、クラスタの問題をリモートでトラブルシューティングし、ローカルでクラスタの状態を迅速に確認するのに役立ちます。PingCAP PingCAPクリニックを利用することで、TiDBクラスタのライフサイクル全体にわたる安定した運用を確保し、潜在的な問題を予測し、問題発生の可能性を低減し、クラスタの問題を迅速にトラブルシューティングして修復することができます。

PingCAPクリニック は、クラスターの問題を診断するために次の 2 つのコンポーネントを提供します。

-   [診断クライアント](https://github.com/pingcap/diag) :

    Diagクライアント（Diag）は、クラスタ側にデプロイされるオープンソースの診断ツールです。Diagは、クラスタ診断データの収集、Clinic Serverへの診断データのアップロード、そしてクラスタ上でローカルで簡単なヘルスチェックを実行するために使用されます。Diagで収集できる診断データの全リストについては、 [PingCAPクリニック診断データ](/clinic/clinic-data-instruction-for-tiup.md)ご覧ください。

    > **注記：**
    >
    > Diag は TiDB v4.0 以降のバージョンをサポートしていますが、TiDB Ansible を使用してデプロイされたクラスターからのデータ収集は**サポートしていません**。

-   クリニックサーバー:

    Clinic Serverはクラウド上に展開されるクラウドサービスです。SaaSモデルで診断サービスを提供することで、Clinic Serverはアップロードされた診断データを受信するだけでなく、データの保存、閲覧、クラスター診断レポートの提供など、オンライン診断環境として機能します。Clinic Serverは、storage場所に応じて2つの独立したサービスを提供します。

    -   [海外ユーザー向けクリニックサーバー](https://clinic.pingcap.com) : データは米国の AWS に保存されます。
    -   [中国本土のユーザー向けクリニックサーバー](https://clinic.pingcap.com.cn) : データは中国 (北京) リージョンの AWS に保存されます。

## ユーザーシナリオ {#user-scenarios}

-   クラスタの問題をリモートでトラブルシューティングする

    クラスターにすぐに解決できない問題が発生した場合、PingCAPまたはコミュニティから[サポートを受ける](/support.md)選択できます。リモートアシスタンスのためにテクニカルサポートに連絡する場合、クラスターからさまざまな診断データを保存し、サポートスタッフに転送する必要があります。この場合、Diagを使用すると、ワンクリックで診断データを収集できます。Diagを使用すると、完全な診断データを迅速に収集できるため、複雑な手動データ収集操作を回避できます。データを収集した後、PingCAPテクニカルサポートスタッフがクラスターの問題をトラブルシューティングできるように、データをクリニックサーバーにアップロードできます。クリニックサーバーは、アップロードされた診断データを安全にstorageし、オンライン診断をサポートすることで、トラブルシューティングの効率を大幅に向上させます。

-   クラスターのステータスを素早く確認

    クラスタが現時点で安定して動作している場合でも、潜在的な安定性リスクを検出するために、定期的にクラスタを検査する必要があります。PingCAP PingCAPクリニックが提供するローカルおよびサーバー側のクイックチェック機能を使用することで、クラスタの潜在的な健全性リスクを特定できます。

## 実施原則 {#implementation-principles}

このセクションでは、Diag がクラスターから診断データを収集する実装原則について説明します。

まず、Diag はデプロイメントツールTiUP (tiup-cluster) またはTiDB Operator ( tidb-operator ) からクラスタトポロジ情報を取得します。次に、Diag は以下のような様々なデータ収集方法を通じて、様々な種類の診断データを収集します。

-   SCP 経由でサーバーファイルを転送する

    TiUPを使用して展開されたクラスターの場合、Diag はセキュリティコピー プロトコル (SCP) を介してターゲットコンポーネントのノードからログ ファイルと構成ファイルを直接収集できます。

-   SSH経由でリモートコマンドを実行してデータを収集する

    TiUPを使用して展開されたクラスターの場合、Diag は SSH ( セキュリティ Shell) を介してターゲットコンポーネントシステムに接続し、コマンド (Insight など) を実行して、カーネル ログ、カーネル パラメーター、システムとハードウェアの基本情報などのシステム情報を取得できます。

-   HTTP呼び出しを通じてデータを収集する

    -   Diag は TiDB コンポーネントの HTTP インターフェイスを呼び出すことで、TiDB、TiKV、PD などのコンポーネントのリアルタイム構成サンプリング情報とリアルタイム パフォーマンス サンプリング情報を取得できます。
    -   Prometheus の HTTP インターフェースを呼び出すことで、Diag はアラート情報と監視メトリック データを取得できます。

-   SQL 文を使用してデータベースパラメータを照会する

    DiagはSQL文を使用して、TiDBのシステム変数やその他の情報を照会できます。この方法を使用するには、データ収集時にTiDBにアクセスするためのユーザー名とパスワードを**追加で入力する**必要があります。

## クリニックサーバーの制限 {#the-limitations-of-clinic-server}

> **注記：**
>
> -   Clinic Serverは2022年7月15日から2025年4月15日まで無料です。それ以降に有料になる場合は、2025年4月15日までにメールでお知らせいたします。
> -   使用制限を調整する場合は、PingCAP から[サポートを受ける](/support.md)実行します。

| サービスタイプ        | 制限          |
| :------------- | :---------- |
| クラスターの数        | 10/組織       |
| ストレージ容量        | 50 GB/クラスター |
| 保存期間           | 180日間       |
| データサイズ         | 3 GB/パッケージ  |
| データ再構築環境の期間を節約 | 3日間         |

## 次のステップ {#next-step}

-   オンプレミス環境でPingCAPクリニックを使用する
    -   [PingCAPクリニックでクイックスタート](/clinic/quick-start-with-clinic.md)
    -   [PingCAPクリニックを使用したクラスターのトラブルシューティング](/clinic/clinic-user-guide-for-tiup.md)
    -   [PingCAPクリニック診断データ](/clinic/clinic-data-instruction-for-tiup.md)

-   Kubernetes でPingCAPクリニックを使用する
    -   [PingCAPクリニックを使用して TiDBクラスタのトラブルシューティングを行う](https://docs.pingcap.com/tidb-in-kubernetes/stable/clinic-user-guide)
    -   [PingCAPクリニック診断データ](https://docs.pingcap.com/tidb-in-kubernetes/stable/clinic-data-collection)
