---
title: TiDB Dashboard Instance Profiling - Continuous Profiling
summary: TiDBダッシュボードの継続的プロファイリングにより、専門家は各インスタンスからパフォーマンスデータを継続的に収集・分析し、高度なパフォーマンス問題を特定・解決することができます。手動プロファイリングよりも多くのデータを保存できるため、現在の問題と過去の問題の両方を分析できます。この機能はダッシュボードまたはブラウザからアクセスでき、必要に応じて有効化/無効化できます。パフォーマンスへの影響は最小限に抑えられるため、本番環境にも最適です。
---

# TiDBダッシュボードインスタンスプロファイリング - 継続的なプロファイリング {#tidb-dashboard-instance-profiling-continuous-profiling}

> **注記：**
>
> この機能はデータベースのエキスパート向けに設計されています。エキスパートでない方は、PingCAPテクニカルサポートの指示に従ってこの機能を使用することをお勧めします。

継続的プロファイリングにより、TiDB、TiKV、PDの各インスタンスからパフォーマンスデータを**継続的に**収集できます。収集されたパフォーマンスデータは、FlameGraphまたはDAG形式で視覚化できます。

これらのパフォーマンスデータにより、専門家はインスタンスのCPUやメモリなどのリソース消費の詳細を分析し、CPUオーバーヘッドの高さ、メモリ使用量の多さ、プロセスの停止など、複雑なパフォーマンス問題をいつでも正確に特定できます。問題を再現できない場合でも、専門家はその時点で収集された過去のパフォーマンスデータを参照することで、問題を深く掘り下げることができます。このようにして、MTTRを効果的に短縮できます。

## 手動プロファイリングと比較 {#compare-with-manual-profiling}

継続的プロファイリングは[手動プロファイリング](/dashboard/dashboard-profiling.md)の拡張機能です。どちらも、各インスタンスの異なる種類のパフォーマンスデータを収集・分析するために使用できます。両者の違いは次のとおりです。

-   手動プロファイリングでは、プロファイリングを開始した瞬間に短期間 (たとえば 30 秒) のみパフォーマンス データが収集されますが、継続プロファイリングが有効になっている場合は、継続的にデータが収集されます。
-   手動プロファイリングは現在発生している問題を分析するためにのみ使用できますが、継続的プロファイリングは現在の問題と履歴の問題の両方を分析するために使用できます。
-   手動プロファイリングでは特定のインスタンスの特定のパフォーマンス データを収集できますが、継続的プロファイリングではすべてのインスタンスのすべてのパフォーマンス データを収集します。
-   継続的なプロファイリングでは、より多くのパフォーマンス データが保存されるため、より多くのディスク領域が使用されます。

## サポートされているパフォーマンスデータ {#supported-performance-data}

[手動プロファイリング](/dashboard/dashboard-profiling.md#supported-performance-data)内のすべてのパフォーマンス データが収集されます。

-   CPU: TiDB、TiKV、 TiFlash、PDインスタンスの各内部関数のCPUオーバーヘッド

-   ヒープ: TiDB、TiKV、PDインスタンス上の各内部関数のメモリ消費量

-   ミューテックス: TiDBおよびPDインスタンス上のミューテックスの競合状態

-   Goroutine: TiDB および PD インスタンス上のすべての Goroutine の実行状態と呼び出しスタック

## ページにアクセスする {#access-the-page}

継続的プロファイリング ページには、次のいずれかの方法でアクセスできます。

-   TiDB ダッシュボードにログインした後、左側のナビゲーション メニューで**[高度なデバッグ]** &gt; **[インスタンスのプロファイリング]** &gt; **[継続的なプロファイリング]**をクリックします。

    ![Access page](/media/dashboard/dashboard-conprof-access.png)

-   ブラウザで[http://127.0.0.1:2379/ダッシュボード/#/継続的なプロファイリング](http://127.0.0.1:2379/dashboard/#/continuous_profiling)アクセスしてください。3 `127.0.0.1:2379`実際のPDインスタンスのアドレスとポートに置き換えてください。

## 継続的なプロファイリングを有効にする {#enable-continuous-profiling}

> **注記：**
>
> 継続的プロファイリングを使用するには、クラスターを最新バージョンのTiUP （v1.9.0以上）またはTiDB Operator （v1.3.0以上）でデプロイまたはアップグレードする必要があります。以前のバージョンのTiUPまたはTiDB Operatorを使用してクラスターをアップグレードした場合は、手順[FAQ](/dashboard/dashboard-faq.md#a-required-component-ngmonitoring-is-not-started-error-is-shown)ご覧ください。

継続的プロファイリングを有効にすると、Webページを常にアクティブにしておくことなく、バックグラウンドで継続的にパフォーマンスデータを収集できます。収集されたデータは一定期間保存され、期限切れのデータは自動的に削除されます。

この機能を有効にするには:

1.  [継続的なプロファイリングページ](#access-the-page)ご覧ください。
2.  **「設定を開く」を**クリックします。右側の**設定**領域で、 **「機能の有効化」**をオンにし、必要に応じて**「保存期間」**のデフォルト値を変更します。
3.  **[保存]を**クリックします。

![Enable feature](/media/dashboard/dashboard-conprof-start.png)

## 現在のパフォーマンスデータをビュー {#view-current-performance-data}

継続的なプロファイリングが有効になっているクラスターでは、手動プロファイリングを開始できません。現時点でのパフォーマンスデータを表示するには、最新のプロファイリング結果をクリックしてください。

## 過去のパフォーマンスデータをビュー {#view-historical-performance-data}

リスト ページでは、この機能を有効にしてから収集されたすべてのパフォーマンス データを確認できます。

![History results](/media/dashboard/dashboard-conprof-history.png)

## パフォーマンスデータをダウンロード {#download-performance-data}

プロファイリング結果ページで、右上隅の**[プロファイリング結果のダウンロード]**をクリックすると、すべてのプロファイリング結果をダウンロードできます。

![Download profiling result](/media/dashboard/dashboard-conprof-download.png)

表内の個々のインスタンスをクリックすると、そのプロファイリング結果を表示できます。また、... にマウスを合わせると、生データをダウンロードできます。

![View profiling result](/media/dashboard/dashboard-conprof-single.png)

## 継続的なプロファイリングを無効にする {#disable-continuous-profiling}

1.  [継続的なプロファイリングページ](#access-the-page)ご覧ください。
2.  右上隅の歯車アイコンをクリックして設定ページを開きます。 **「機能の有効化」**をオフにします。
3.  **[保存]を**クリックします。
4.  ポップアップされたダイアログボックスで、 **[無効にする]**をクリックします。

![Disable feature](/media/dashboard/dashboard-conprof-stop.png)

## よくある質問 {#frequently-asked-questions}

**1. 継続的なプロファイリングを有効にできず、UI に「必要なコンポーネントNgMonitoring が開始されていません」と表示されます**。

[TiDBダッシュボードFAQ](/dashboard/dashboard-faq.md#a-required-component-ngmonitoring-is-not-started-error-is-shown)参照。

**2. 継続的なプロファイリングを有効にするとパフォーマンスに影響はありますか?**

当社のベンチマークによると、この機能を有効にすると、パフォーマンスへの平均的な影響は 1% 未満になります。

**3. この機能のステータスはどうなっていますか?**

これは現在、一般公開 (GA) された機能であり、本番環境で使用できます。
