---
title: Stress Test TiDB Using TiUP Bench Component
summary: Learns how to stress test TiDB with TPC-C and TPC-H workloads using TiUP.
category: tools
---

# Stress Test TiDB Using TiUP Bench Component

When you test the performance of a database, it is often required to stress test the database. To facilitate this, TiUP has integrated the bench component, which currently provides two workloads for stress testing: TPC-C and TPC-H. Their commands and parameters are as follows:

{{< copyable "shell-root" >}}

```bash
tiup bench
```

```
Starting component `bench`: /Users/joshua/.tiup/components/bench/v0.0.1/bench 
Benchmark database with different workloads
Usage:
  tiup bench [command]

Available Commands:
  help        Help information
  tpcc        Stress test with TPC-C as the workload
  tpch        Stress test with TPC-H as the workload

Flags:
      --count int           Total execution count. `0` means infinite
  -D, --db string           Name of the database to be tested (default "test")
  -d, --driver string       Database driver: mysql
      --dropdata            Clean up old data before prepare
  -h, --help                Help information for bench command
  -H, --host string         Database host (default "127.0.0.1")
      --ignore-error        Ignore errors returned during the stress test
      --interval duration   Output interval time (default 10s)
      --isolation int       Isolation Level 0: Default, 1: ReadUncommitted, 
                            2: ReadCommitted, 3: WriteCommitted, 4: RepeatableRead, 
                            5: Snapshot, 6: Serializable, 7: Linerizable
      --max-procs int       runtime.GOMAXPROCS
  -p, --password string     Database password
  -P, --port int            Database port (default 4000)
      --pprof string        Address of pprof
      --silence             Don't print error during the stress test
      --summary             Only print summary
  -T, --threads int         Thread concurrency (default 16)
      --time duration       Total execution time (default 2562047h47m16.854775807s)
  -U, --user string         Database user during the stress test (default "root")
```

The following sections describe how to run TPC-C and TPC-H tests using TiUP.

## Run TPC-C test using TiUP

The TiUP bench component supports the following commands and parameters of TPC-C test:

```bash
Available Commands:
  check       Check for data consistency
  cleanup     Clean up data
  prepare     Prepare data
  run         Run stress test

Flags:
      --check-all        Run all consistency checks
  -h, --help             TPCC help information
      --output string    The directory where the csv file is generated when data is prepared
      --parts int        The number of partitioned repositories (default 1)
      --tables string    Specifies the tables used to generate the file.Multiple tables are separated with commas. It is only valid if output is set. All tables are generated by default.
      --warehouses int   The number of repositories (default 10)
```

### Test procedures

1. Create 4 repositories using 4 partitions with hash:

    ```shell
    tiup bench tpcc --warehouses 4 --parts 4 prepare
    ```

2. Run the TPC-C test:

    {{< copyable "shell-regular" >}}

    ```shell
    tiup bench tpcc --warehouses 4 run
    ```

3. Clean up data:

    {{< copyable "shell-regular" >}}

    ```shell
    tiup bench tpcc --warehouses 4 cleanup
    ```

4. Check the consistency:

    {{< copyable "shell-regular" >}}

    ```shell
    tiup bench tpcc --warehouses 4 check
    ```

5. Generate the CSV file:

    {{< copyable "shell-regular" >}}

    ```shell
    tiup bench tpcc --warehouses 4 prepare --output data
    ```

6. Generate the CSV file for the specified table:

    {{< copyable "shell-regular" >}}

    ```shell
    tiup bench tpcc --warehouses 4 prepare --output data --tables history,orders
    ```

7. Enable pprof:

    {{< copyable "shell-regular" >}}

    ```shell
    tiup bench tpcc --warehouses 4 prepare --output data --pprof :10111
    ```

## Run TPC-P test using TiUP

The TiUP bench component supports the following commands and parameters of TPC-P test:

```bash
Available Commands:
  cleanup     Clean up data
  prepare     Prepare data
  run         Run stress test

Flags:
      --check            Check the output data. Only valid when the scale factor is `1`.
  -h, --help             tpch help information
      --queries string   All the query statements ("q1,q2,q3,q4,q5,q6,q7,q8,q9,q10,q11,q12,q13,q14,q15,q16,q17,q18,q19,q20,q21,q22" by default)
      --sf int           scale factor
```

### Test procedures

1. Prepare data:

    {{< copyable "shell-regular" >}}

    ```shell
    tiup bench tpch --sf=1 prepare
    ```

2. Run the TPC-H test by executing one of the following commands:

    - If you check the result:

        {{< copyable "shell-regular" >}}

        ```shell
        tiup bench tpch --sf=1 --check=true run
        ```
    
    - If you do not check the result:

        {{< copyable "shell-regular" >}}

        ```shell
        tiup bench tpch --sf=1 run
        ```
    
3. Clean up data:

    {{< copyable "shell-regular" >}}

    ```shell
    tiup bench tpch cleanup
    ```
