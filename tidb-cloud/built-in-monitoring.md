---
title: TiDB Cloud Built-in Metrics
summary: TiDB Cloudの組み込みメトリックを表示する方法と、これらのメトリックの意味を理解する方法について説明します。
---

# TiDB Cloud組み込みメトリクス {#tidb-cloud-built-in-metrics}

TiDB Cloudは、クラスターの標準的なメトリクスを一式収集し、「メトリクス」ページに表示します。これらのメトリクスを表示することで、パフォーマンスの問題を簡単に特定し、現在のデータベース環境が要件を満たしているかどうかを判断できます。

## メトリクスページをビュー {#view-the-metrics-page}

**「メトリック」**ページでメトリックを表示するには、次の手順を実行します。

1.  プロジェクトの[**クラスター**](https://tidbcloud.com/project/clusters)ページで、ターゲット クラスターの名前をクリックして、概要ページに移動します。

    > **ヒント：**
    >
    > 左上隅のコンボ ボックスを使用して、組織、プロジェクト、クラスターを切り替えることができます。

2.  左側のナビゲーション ペインで、 **[監視]** &gt; **[メトリック]**をクリックします。

## メトリクス保持ポリシー {#metrics-retention-policy}

TiDB Cloudクラスターの場合、メトリック データは 7 日間保持されます。

## TiDB Cloud Dedicated クラスタのメトリクス {#metrics-for-tidb-cloud-dedicated-clusters}

次のセクションでは、 TiDB Cloud Dedicated クラスターの**メトリック**ページのメトリックについて説明します。

### 概要 {#overview}

| メトリック名              | ラベル                                 | 説明                                                                                                                                                                                                                                                                                                                          |
| :------------------ | :---------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| SQLタイプ別のデータベース時間    | データベース時間、{SQLタイプ}                   | データベース時間: 1 秒あたりの合計データベース時間。<br/> {SQL タイプ}: 1 秒あたりに SQL ステートメントによって消費されたデータベース時間`SELECT`などの SQL `INSERT` `UPDATE`に収集されます。                                                                                                                                                                                                  |
| 1秒あたりのクエリ数          | {SQL タイプ}                           | すべての TiDB インスタンスで 1 秒あたりに実行された SQL ステートメントの数`SELECT` 、 `INSERT` 、 `UPDATE`などの SQL タイプ別に収集されます。                                                                                                                                                                                                                              |
| クエリ期間               | 平均-{SQLタイプ}、99-{SQLタイプ}             | クライアントからのリクエストをTiDBが受信してから、TiDBがそのリクエストを実行し、結果をクライアントに返すまでの時間です。通常、クライアントからのリクエストはSQL文の形式で送信されますが、この時間には`COM_PING` 、 `COM_SLEEP` 、 `COM_STMT_FETCH` 、 `COM_SEND_LONG_DATA`などのコマンドの実行時間も含まれる場合があります。TiDBはマルチクエリをサポートしており、クライアントは`select 1; select 1; select 1;`などの複数のSQL文を一度に送信できます。この場合、このクエリの合計実行時間には、すべてのSQL文の実行時間が含まれます。 |
| 失敗したクエリ             | すべて、{エラータイプ} @ {インスタンス}             | 各TiDBインスタンスにおける1分あたりのSQL文実行エラー数に基づく、エラーの種類（構文エラーや主キーの競合など）の統計情報。エラーが発生したモジュールとエラーコードが含まれます。                                                                                                                                                                                                                                 |
| 1秒あたりのコマンド数         | クエリ、StmtExecute、および StmtPrepare     | コマンドの種類に基づいて、すべての TiDB インスタンスによって 1 秒あたりに処理されるコマンドの数。                                                                                                                                                                                                                                                                       |
| プランキャッシュOPSを使用したクエリ | ヒット、ミス                              | ヒット: すべての TiDB インスタンスで 1 秒あたりにプラン キャッシュを使用するクエリの数。<br/>ミス: すべての TiDB インスタンスにおける 1 秒あたりのプラン キャッシュが欠落しているクエリの数。                                                                                                                                                                                                               |
| 1秒あたりのトランザクション      | {タイプ}-{トランザクション モデル}                | 1 秒あたりに実行されるトランザクションの数。                                                                                                                                                                                                                                                                                                     |
| トランザクション期間          | 平均-{トランザクション モデル}、99-{トランザクション モデル} | トランザクションの平均期間または 99 パーセンタイル期間。                                                                                                                                                                                                                                                                                              |
| 接続数                 | すべて、アクティブな接続                        | すべて: すべての TiDB インスタンスへの接続数。<br/>アクティブ接続: すべての TiDB インスタンスへのアクティブな接続の数。                                                                                                                                                                                                                                                      |
| 切断回数                | {インスタンス}-{結果}                       | 各 TiDB インスタンスから切断されたクライアントの数。                                                                                                                                                                                                                                                                                               |

### 高度な {#advanced}

| メトリック名                    | ラベル                     | 説明                                                                                                                                              |
| :------------------------ | :---------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------- |
| 平均アイドル接続時間                | 平均トランザクション内、平均トランザクション外 | 接続アイドル期間は、接続がアイドル状態にある期間を示します。<br/> avg-in-txn: 接続がトランザクション内にあるときの平均接続アイドル期間。<br/> avg-not-in-txn: 接続がトランザクション内にない場合の平均接続アイドル期間。                |
| トークンの有効期限を取得する            | 平均、99                   | SQL ステートメントのトークンを取得するのに費やされた平均または 99 パーセンタイル期間。                                                                                                 |
| 解析期間                      | 平均、99                   | SQL ステートメントの解析に費やされた平均または 99 パーセンタイル期間。                                                                                                         |
| コンパイル時間                   | 平均、99                   | 解析された SQL AST を実行プランにコンパイルするのにかかった平均時間または 99 パーセンタイル時間。                                                                                         |
| 実行時間                      | 平均、99                   | SQL ステートメントの実行プランの実行に費やされた平均または 99 パーセンタイル期間。                                                                                                   |
| 平均 TiDB KV リクエスト期間        | {リクエストタイプ}              | `Get` 、 `Prewrite` 、 `Commit`などのリクエスト タイプに基づいて、すべての TiDB インスタンスで KV リクエストの実行に費やされた平均時間。                                                         |
| 平均 TiKV gRPC 期間           | {リクエストタイプ}              | `kv_get` 、 `kv_prewrite` 、 `kv_commit`などのリクエスト タイプに基づいて、すべての TiKV インスタンスで gRPC リクエストの実行に費やされた平均時間。                                              |
| 平均 / P99 PD TSO 待機/RPC 期間 | 待機平均/99、rpc平均/99        | 待機: すべての TiDB インスタンスで PD が TSO を返すのを待機する平均期間または 99 パーセンタイル期間。<br/> RPC: すべての TiDB インスタンスで TSO 要求を PD に送信してから TSO を受信するまでの平均時間または 99 パーセンタイルの期間。 |
| 平均 / P99 ストレージ非同期書き込み時間   | 平均、99                   | 非同期書き込みに費やされた平均時間または 99 パーセンタイル時間。平均storage非同期書き込み時間 = 平均保存時間 + 平均適用時間。                                                                         |
| 平均 / P99 店舗期間             | 平均、99                   | 非同期書き込み中にループの保存に費やされた平均または 99 パーセンタイル期間。                                                                                                        |
| 平均 / P99 適用期間             | 平均、99                   | 非同期書き込み中にループを適用するのに費やされた平均または 99 パーセンタイル期間。                                                                                                     |
| 平均 / P99 追加ログ期間           | 平均、99                   | Raftがログを追加するために要した平均または 99 パーセンタイル期間。                                                                                                           |
| 平均 / P99 コミットログ期間         | 平均、99                   | Raftがログをコミットするのに要した平均または 99 パーセンタイル期間。                                                                                                          |
| 平均 / P99 適用ログ期間           | 平均、99                   | Raftがログを適用するために要した平均または 99 パーセンタイル期間。                                                                                                           |
| 影響を受ける行                   | {SQL タイプ}               | SQL タイプ別に 1 秒あたりに処理される行数。                                                                                                                       |
| Leader数                   | {実例}                    | TiKV ノードによってホストされるRaftリーダー領域の数。                                                                                                                 |
| リージョン数                    | {実例}                    | TiKV ノードによって管理されるデータ領域の合計。                                                                                                                      |

### サーバ {#server}

| メトリック名          | ラベル             | 説明                                         |
| :-------------- | :-------------- | :----------------------------------------- |
| TiDB 稼働時間       | ノード             | 前回の再起動以降の各 TiDB ノードの実行時間。                  |
| TiDB CPU 使用率    | ノード、制限          | 各 TiDB ノードの CPU 使用率統計または上限。                |
| TiDB メモリ使用量     | ノード、制限          | 各 TiDB ノードのメモリ使用量の統計または上限。                 |
| TiKV稼働時間        | ノード             | 前回の再起動以降の各 TiKV ノードの実行時間。                  |
| TiKV CPU使用率     | ノード、制限          | 各 TiKV ノードの CPU 使用率統計または上限。                |
| TiKV メモリ使用量     | ノード、制限          | 各 TiKV ノードのメモリ使用量の統計または上限。                 |
| TiKV IO Bps     | ノード書き込み、ノード読み取り | 各 TiKV ノードでの読み取りおよび書き込みの 1 秒あたりの合計入出力バイト数。 |
| TiKV ストレージ使用量   | ノード、制限          | 各 TiKV ノードのstorage使用状況統計または上限。             |
| TiFlashの稼働時間    | ノード             | 前回の再起動以降の各TiFlashノードの実行時間。                 |
| TiFlash CPU 使用率 | ノード、制限          | 各TiFlashノードの CPU 使用率統計または上限。               |
| TiFlashメモリ使用量   | ノード、制限          | 各TiFlashノードのメモリ使用量の統計または上限。                |
| TiFlash IO MBps | ノード書き込み、ノード読み取り | 各TiFlashノードでの読み取りおよび書き込みの合計バイト数。           |
| TiFlashストレージ使用量 | ノード、制限          | 各TiFlashノードのstorage使用状況統計または上限。            |

## TiDB Cloud Starter および Essential クラスターのメトリクス {#metrics-for-tidb-cloud-starter-and-essential-clusters}

**メトリクス**ページには、TiDB Cloud Starter クラスターとTiDB Cloud Essential クラスターのメトリクス用の 2 つのタブがあります。

-   **クラスタステータス**: クラスター レベルの主なメトリックを表示します。
-   **データベース ステータス**: データベース レベルの主なメトリックを表示します。

### クラスタステータス {#cluster-status}

次の表は**、 「クラスタステータス」**タブのクラスター レベルの主なメトリックを示しています。

| メトリック名         | ラベル                       | 説明                                                                                                                                                 |
| :------------- | :------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------- |
| リクエストユニット      | RU/秒                      | リクエストユニット（RU）は、クエリまたはトランザクションのリソース消費量を追跡するための測定単位です。リクエストユニットは、実行したクエリだけでなく、バックグラウンドアクティビティによっても消費されるため、QPSが0の場合でも、1秒あたりのリクエストユニット数は0にならない場合があります。 |
| 使用済みストレージサイズ   | 行ベースのstorage、列ベースのstorage | 行ストアのサイズと列ストアのサイズ。                                                                                                                                 |
| 1秒あたりのクエリ数     | すべて、{SQL タイプ}             | 1 秒あたりに実行された SQL ステートメントの数。1 、 `SELECT` 、 `UPDATE`などの SQL `INSERT`別に収集されます。                                                                        |
| 平均クエリ期間        | すべて、{SQL タイプ}             | TiDB Cloud Starter またはTiDB Cloud Essential クラスターへのクライアントからのリクエストを受信してから、クラスターがリクエストを実行して結果をクライアントに返すまでの期間。                                         |
| 失敗したクエリ        | 全て                        | 1 秒あたりの SQL ステートメント実行エラーの数。                                                                                                                        |
| 1秒あたりのトランザクション | 全て                        | 1 秒あたりに実行されるトランザクションの数。                                                                                                                            |
| 平均トランザクション期間   | 全て                        | トランザクションの平均実行時間。                                                                                                                                   |
| トータルコネクション     | 全て                        | TiDB Cloud Starter またはTiDB Cloud Essential クラスターへの接続の数。                                                                                            |

### データベースのステータス {#database-status}

次の表は**、「データベース ステータス」**タブのデータベース レベルの主なメトリックを示しています。

| メトリック名          | ラベル           | 説明                                                                                    |
| :-------------- | :------------ | :------------------------------------------------------------------------------------ |
| DBあたりのQPS       | すべて、{データベース名} | 各データベースで 1 秒あたりに実行された SQL ステートメントの数`SELECT` 、 `INSERT` 、 `UPDATE`などの SQL タイプ別に収集されます。 |
| DBあたりの平均クエリ実行時間 | すべて、{データベース名} | クライアントからデータベースへのリクエストを受信してから、データベースがリクエストを実行し、結果をクライアントに返すまでの期間。                      |
| DBごとの失敗したクエリ    | すべて、{データベース名} | 各データベースでの 1 秒あたりの SQL ステートメント実行エラーに応じたエラー タイプの統計。                                     |

## FAQ {#faq}

**1. このページの一部のペインが空になっているのはなぜですか?**

ペインにメトリックが表示されない場合は、次のような理由が考えられます。

-   対応するクラスターのワークロードはこのメトリックをトリガーしません。たとえば、失敗したクエリがない場合、失敗したクエリのメトリックは常に空になります。
-   クラスターのバージョンが低いです。これらのメトリクスを表示するには、TiDB の最新バージョンにアップグレードする必要があります。

これらすべての理由が除外される場合は、トラブルシューティングのために[PingCAPサポートチーム](/tidb-cloud/tidb-cloud-support.md)問い合わせることができます。

**2. まれにメトリックが不連続になることがあるのはなぜですか?**

まれに、メトリクス システムに高い圧力がかかった場合など、メトリクスが失われる場合があります。

この問題が発生した場合は、トラブルシューティングのために[PingCAP サポート](/tidb-cloud/tidb-cloud-support.md)お問い合わせください。
