---
title: TiDB Cloud Built-in Metrics
summary: TiDB Cloudはクラスターの標準メトリックを収集し、パフォーマンスの問題を特定できます。メトリックページで手順に従い、メトリクスを表示します。TiDB専用クラスターのメトリックには、データベース時間、クエリ数、失敗したクエリなどが含まれます。TiDBサーバーレスクラスターのメトリックには、リクエストユニット、使用済みストレージのサイズ、クエリ数などが含まれます。メトリクスが不連続になる場合は、高い負荷やバージョンの問題が考えられます。
---

# TiDB Cloudの組み込みメトリクス {#tidb-cloud-built-in-metrics}

TiDB Cloudは、クラスターの標準メトリックの完全なセットを収集し、[メトリック] ページに表示します。これらのメトリクスを表示することで、パフォーマンスの問題を簡単に特定し、現在のデータベース展開が要件を満たしているかどうかを判断できます。

## メトリクスページをビュー {#view-the-metrics-page}

[メトリック] ページでメトリックを表示するには、次の手順を実行します。

1.  [TiDB Cloudコンソール](https://tidbcloud.com/)で、プロジェクトの[**クラスター**](https://tidbcloud.com/console/clusters)ページに移動します。

    > **ヒント：**
    >
    > 複数のプロジェクトがある場合は、<mdsvgicon name="icon-left-projects">左下隅の をクリックして、別のプロジェクトに切り替えます。</mdsvgicon>

2.  ターゲットクラスターの名前をクリックします。クラスターの概要ページが表示されます。

3.  左側のナビゲーションペインで**「メトリクス」**をクリックします。

## メトリクス保持ポリシー {#metrics-retention-policy}

TiDB 専用クラスターおよび TiDB サーバーレスクラスターの場合、メトリクスデータは 7 日間保持されます。

## TiDB 専用クラスターのメトリック {#metrics-for-tidb-dedicated-clusters}

次のセクションでは、TiDB 専用クラスターの [メトリック] ページのメトリックを説明します。

### 概要 {#overview}

| メトリクス名                 | ラベル                                  | 説明                                                                                                                                                                                                                                                                                                                                                                   |
| :--------------------- | :----------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| SQL タイプごとのデータベース時間     | データベース時間、{SQL タイプ}                   | データベース時間: 1 秒あたりの合計データベース時間。<br/> {SQL タイプ}: SQL ステートメントによって消費された 1 秒あたりのデータベース時間。これは、 `SELECT` 、 `INSERT` 、 `UPDATE`などの SQL タイプごとに収集されます。                                                                                                                                                                                                                           |
| 1 秒あたりのクエリ数            | {SQL タイプ}                            | すべての TiDB インスタンスで 1 秒あたりに実行された SQL ステートメントの数。SQL タイプ ( `SELECT` 、 `INSERT` 、 `UPDATE`など) ごとに収集されます。                                                                                                                                                                                                                                                                  |
| クエリ期間                  | avg-{SQL タイプ}、99-{SQL タイプ}           | クライアントから TiDB へのリクエストを受信して​​から、TiDB がリクエストを実行して結果をクライアントに返すまでの期間。一般に、クライアント要求は SQL ステートメントの形式で送信されます。ただし、この期間には`COM_PING` 、 `COM_SLEEP` 、 `COM_STMT_FETCH` 、 `COM_SEND_LONG_DATA`などのコマンドの実行時間が含まれる場合があります。 TiDB はマルチクエリをサポートしています。これは、クライアントが一度に複数の SQL ステートメント ( `select 1; select 1; select 1;`など) を送信できることを意味します。この場合、このクエリの合計実行時間には、すべての SQL ステートメントの実行時間が含まれます。 |
| 失敗したクエリ                | すべて、{エラー タイプ} @ {インスタンス}             | 各 TiDB インスタンスでの 1 分あたりの SQL ステートメント実行エラーに基づく、エラー タイプ (構文エラーや主キーの競合など) の統計。エラーが発生したモジュールとエラーコードが含まれます。                                                                                                                                                                                                                                                                |
| 1秒あたりのコマンド             | クエリ、StmtExecute、および StmtPrepare      | コマンド タイプに基づく、すべての TiDB インスタンスによって 1 秒あたりに処理されるコマンドの数。                                                                                                                                                                                                                                                                                                                |
| プラン キャッシュ OPS を使用したクエリ | ヒット、ミス                               | hit: すべての TiDB インスタンスにおける 1 秒あたりのプラン キャッシュを使用するクエリの数。<br/> miss: すべての TiDB インスタンスでプラン キャッシュが欠落しているクエリの 1 秒あたりの数。                                                                                                                                                                                                                                                     |
| 1秒あたりのトランザクション         | {タイプ}-{トランザクション モデル}                 | 1 秒あたりに実行されるトランザクションの数。                                                                                                                                                                                                                                                                                                                                              |
| トランザクション期間             | avg-{トランザクション モデル}、99-{トランザクション モデル} | トランザクションの平均期間または 99 パーセンタイルの期間。                                                                                                                                                                                                                                                                                                                                      |
| 接続数                    | すべて、アクティブな接続                         | すべて: すべての TiDB インスタンスへの接続の数。<br/>アクティブな接続: すべての TiDB インスタンスへのアクティブな接続の数。                                                                                                                                                                                                                                                                                             |
| 切断回数                   | {インスタンス}-{結果}                        | 各 TiDB インスタンスに切断されたクライアントの数。                                                                                                                                                                                                                                                                                                                                         |

### 高度な {#advanced}

| メトリクス名                    | ラベル                    | 説明                                                                                                                                                  |
| :------------------------ | :--------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------- |
| 平均アイドル接続時間                | TXN 内の平均、TXN 内にない平均    | 接続アイドル期間は、接続がアイドル状態である期間を示します。<br/> avg-in-txn: 接続がトランザクション内にある場合の平均接続アイドル期間。<br/> avg-not-in-txn: 接続がトランザクション内にない場合の平均接続アイドル時間。                    |
| トークンの有効期間を取得する            | 平均、99                  | SQL ステートメントのトークンを取得するために消費された平均期間または 99 パーセンタイルの期間。                                                                                                 |
| 解析期間                      | 平均、99                  | SQL ステートメントの解析に費やされた平均時間または 99 パーセンタイル時間。                                                                                                           |
| コンパイル時間                   | 平均、99                  | 解析された SQL AST を実行プランにコンパイルするために費やされた平均時間または 99 パーセンタイルの時間。                                                                                          |
| 実行期間                      | 平均、99                  | SQL ステートメントの実行プランの実行に費やされる平均時間または 99 パーセンタイル時間。                                                                                                     |
| TiDB KV リクエストの平均期間        | {リクエストの種類}             | リクエスト タイプ ( `Get` 、 `Prewrite` 、 `Commit`など) に基づく、すべての TiDB インスタンスでの KV リクエストの実行にかかる平均時間。                                                           |
| TiKV gRPC の平均期間           | {リクエストの種類}             | リクエスト タイプ ( `kv_get` 、 `kv_prewrite` 、 `kv_commit`など) に基づく、すべての TiKV インスタンスでの gRPC リクエストの実行にかかる平均時間。                                                |
| 平均 / P99 PD TSO 待機/RPC 期間 | wait-avg/99、rpc-avg/99 | 待機: すべての TiDB インスタンスで PD が TSO を返すのを待機する平均時間または 99 パーセンタイルの時間。<br/> RPC: すべての TiDB インスタンスで TSO リクエストを PD に送信してから TSO を受信するまでの平均時間または期間の 99 パーセンタイル。 |
| 平均 / P99 ストレージ非同期書き込み期間   | 平均、99                  | 非同期書き込みで消費された平均時間または 99 パーセンタイル時間。平均storage非同期書き込み期間 = 平均ストア期間 + 平均適用期間。                                                                            |
| 平均 / P99 ストア期間            | 平均、99                  | 非同期書き込み中のループの保存に消費された平均または 99 パーセンタイルの期間。                                                                                                           |
| 平均 / P99 適用期間             | 平均、99                  | 非同期書き込み中にループを適用する際に消費された平均時間または 99 パーセンタイル時間。                                                                                                       |
| 平均 / P99 追加ログ期間           | 平均、99                  | Raftがログを追加するために消費した平均時間または 99 パーセンタイル時間。                                                                                                            |
| 平均 / P99 コミット ログ期間        | 平均、99                  | Raftがログをコミットするために費やした平均時間または 99 パーセンタイル時間。                                                                                                          |
| 平均 / P99 適用ログ期間           | 平均、99                  | Raftがログを適用するために消費した平均時間または 99 パーセンタイル時間。                                                                                                            |

### サーバ {#server}

| メトリクス名           | ラベル             | 説明                                        |
| :--------------- | :-------------- | :---------------------------------------- |
| TiDB 稼働時間        | ノード             | 前回の再起動以降の各 TiDB ノードの実行時間。                 |
| TiDB CPU 使用率     | ノード、制限          | 各 TiDB ノードの CPU 使用率の統計または上限。              |
| TiDB のメモリ使用量     | ノード、制限          | 各 TiDB ノードのメモリ使用量の統計または上限。                |
| TiKV 稼働時間        | ノード             | 前回の再起動以降の各 TiKV ノードのランタイム。                |
| TiKV CPU 使用率     | ノード、制限          | 各 TiKV ノードの CPU 使用率統計または上限。               |
| TiKV のメモリ使用量     | ノード、制限          | 各 TiKV ノードのメモリ使用量の統計または上限。                |
| TiKV IO Bps      | ノード書き込み、ノード読み取り | 各 TiKV ノードの 1 秒あたりの読み取りおよび書き込みの合計入出力バイト数。 |
| TiKV ストレージの使用量   | ノード、制限          | 各 TiKV ノードのstorage使用量の統計または上限。            |
| TiFlash稼働時間      | ノード             | 前回の再起動以降の各TiFlashノードのランタイム。               |
| TiFlash CPU 使用率  | ノード、制限          | 各TiFlashノードの CPU 使用率統計または上限。              |
| TiFlashメモリの使用量   | ノード、制限          | 各TiFlashノードのメモリ使用量の統計または上限。               |
| TiFlash IO MBps  | ノード書き込み、ノード読み取り | 各TiFlashノードの読み取りおよび書き込みの合計バイト数。           |
| TiFlashストレージの使用量 | ノード、制限          | 各TiFlashノードのstorage使用量統計または上限。            |

## TiDB サーバーレスクラスターのメトリクス {#metrics-for-tidb-serverless-clusters}

[メトリック] ページには、TiDB サーバーレス クラスターのメトリック用の 2 つのタブがあります。

-   クラスタのステータス: クラスターレベルの主要なメトリックを表示します。
-   データベース ステータス: データベース レベルの主要なメトリックを表示します。

### クラスタのステータス {#cluster-status}

次の表は、 **[クラスタステータス]**タブのクラスター レベルの主要なメトリックを示しています。

| メトリクス名         | ラベル                      | 説明                                                                                                                                                                 |
| :------------- | :----------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| リクエストユニット      | RU/秒                     | リクエスト ユニット (RU) は、クエリまたはトランザクションのリソース消費を追跡するために使用される測定単位です。実行するクエリに加えて、リクエスト ユニットはバックグラウンド アクティビティによって消費される可能性があるため、QPS が 0 の場合、1 秒あたりのリクエスト ユニットがゼロにならない可能性があります。 |
| 使用済みストレージのサイズ  | 行ベースのstorage、列指向のstorage | 行ストアのサイズと列ストアのサイズ。                                                                                                                                                 |
| 1 秒あたりのクエリ数    | すべて、{SQL タイプ}            | 1 秒あたりに実行された SQL ステートメントの数。SQL タイプごとに収集されます ( `SELECT` 、 `INSERT` 、 `UPDATE`など)。                                                                                   |
| 平均クエリ継続時間      | すべて、{SQL タイプ}            | クライアントから TiDB サーバーレス クラスターへのリクエストを受信して​​から、クラスターがリクエストを実行して結果をクライアントに返すまでの期間。                                                                                      |
| 失敗したクエリ        | 全て                       | 1 秒あたりの SQL ステートメント実行エラーの数。                                                                                                                                        |
| 1秒あたりのトランザクション | 全て                       | 1 秒あたりに実行されるトランザクションの数。                                                                                                                                            |
| 平均トランザクション期間   | 全て                       | トランザクションの平均実行期間。                                                                                                                                                   |
| 総接続数           | 全て                       | TiDB サーバーレス クラスターへの接続の数。                                                                                                                                           |

### データベースのステータス {#database-status}

次の表は、 **[データベース ステータス]**タブのデータベース レベルの主要なメトリックを示しています。

| メトリクス名         | ラベル           | 説明                                                                                            |
| :------------- | :------------ | :-------------------------------------------------------------------------------------------- |
| DBごとのQPS       | すべて、{データベース名} | すべてのデータベースで 1 秒あたりに実行された SQL ステートメントの数。SQL タイプ ( `SELECT` 、 `INSERT` 、 `UPDATE`など) ごとに収集されます。 |
| DBごとの平均クエリ継続時間 | すべて、{データベース名} | クライアントからデータベースへのリクエストを受信して​​から、データベースがリクエストを実行して結果をクライアントに返すまでの期間。                            |
| DBごとの失敗したクエリ   | すべて、{データベース名} | すべてのデータベースにおける 1 秒あたりの SQL ステートメント実行エラーに基づくエラー タイプの統計。                                        |

## FAQ {#faq}

**1. このページの一部のペインが空になっているのはなぜですか?**

ペインにメトリックが表示されない場合、考えられる理由は次のとおりです。

-   対応するクラスターのワークロードによってこのメトリクスがトリガーされることはありません。たとえば、失敗したクエリがない場合、失敗したクエリ メトリックは常に空になります。
-   クラスターのバージョンが低いです。これらのメトリクスを表示するには、TiDB の最新バージョンにアップグレードする必要があります。

これらの理由がすべて除外される場合は、トラブルシューティングのために[PingCAP サポート チーム](/tidb-cloud/tidb-cloud-support.md)に問い合わせることができます。

**2. メトリクスがまれに不連続になる場合があるのはなぜですか?**

まれに、メトリクス システムに高い負荷がかかる場合など、メトリクスが失われることがあります。

この問題が発生した場合は、トラブルシューティングのために[PingCAP のサポート](/tidb-cloud/tidb-cloud-support.md)に連絡してください。
