---
title: Deploy Data App Automatically with GitHub
summary: GitHub を使用してデータ アプリを自動的にデプロイする方法を学びます。
---

# GitHub でデータアプリを自動デプロイ {#deploy-data-app-automatically-with-github}

TiDB Cloud は、 JSON 構文を使用してデータ アプリの構成全体をコードとして表現する、 コンフィグレーション as Code (CaC) アプローチを提供します。

データ アプリを GitHub に接続することで、 TiDB Cloud はCaC アプローチを使用して、データ アプリの構成を[設定ファイル](/tidb-cloud/data-service-app-config-files.md)として優先 GitHub リポジトリおよびブランチにプッシュできます。

GitHub接続で**自動同期とデプロイ**が有効になっている場合は、GitHub上の設定ファイルを更新することでデータアプリを変更することもできます。設定ファイルの変更をGitHubにプッシュすると、新しい設定がTiDB Cloudに自動的にデプロイされます。

このドキュメントでは、GitHub を使用してデータ アプリを自動的にデプロイする方法と、GitHub 接続を管理する方法について説明します。

## 始める前に {#before-you-begin}

データ アプリを GitHub に接続する前に、次のものを用意してください。

-   GitHub アカウント。
-   ターゲット ブランチを含む GitHub リポジトリ。

> **注記：**
>
> GitHubリポジトリは、データアプリを接続した後に[データアプリの構成ファイル](/tidb-cloud/data-service-app-config-files.md)保存するために使用されます。設定ファイル内の情報（クラスタIDやエンドポイントURLなど）が機密情報である場合は、パブリックリポジトリではなくプライベートリポジトリを使用してください。

## ステップ1. データアプリをGitHubに接続する {#step-1-connect-your-data-app-to-github}

データアプリを作成する際に、GitHub に接続できます。詳細については、 [データアプリを作成する](/tidb-cloud/data-service-manage-data-app.md)ご覧ください。

アプリの作成中に GitHub 接続を有効にしなかった場合でも、次のように有効にすることができます。

1.  プロジェクトの[**データサービス**](https://tidbcloud.com/project/data-service)ページに移動します。

2.  左側のペインで、対象のデータ アプリの名前をクリックして詳細を表示します。

3.  **「設定」**タブの**「GitHubに接続」**エリアで**「接続」**をクリックします。接続設定用のダイアログボックスが表示されます。

4.  ダイアログ ボックスで、次の手順を実行します。

    1.  **「GitHub にインストール」を**クリックし、画面の指示に従って、 **TiDB Cloud Data Service を**アプリケーションとしてターゲット リポジトリにインストールします。

    2.  **「承認」**をクリックして、GitHub 上のアプリケーションへのアクセスを承認します。

    3.  データ アプリの構成ファイルを保存するターゲット リポジトリ、ブランチ、ディレクトリを指定します。

        > **注記：**
        >
        > -   ディレクトリはスラッシュ（ `/` ）で始まる必要があります。例えば、 `/mydata` 。指定したディレクトリがターゲットリポジトリとブランチに存在しない場合は、自動的に作成されます。
        > -   リポジトリ、ブランチ、ディレクトリの組み合わせは、設定ファイルのパスを識別します。このパスはデータアプリ間で一意である必要があります。指定したパスが既に別のデータアプリで使用されている場合は、新しいパスを指定する必要があります。そうしないと、 TiDB Cloudコンソールで現在のデータアプリ用に設定されたエンドポイントによって、指定したパス内のファイルが上書きされます。
        > -   指定したパスに別のデータ アプリからコピーされた構成ファイルが含まれており、これらのファイルを現在のデータ アプリにインポートする場合は、 [既存のデータアプリの構成をインポートする](#import-configurations-of-an-existing-data-app)参照してください。

    4.  TiDB Cloudコンソールまたは GitHub のいずれかで行われたデータ アプリの変更が相互に同期されるようにするには、**自動同期とデプロイメントの構成を**有効にします。

        -   有効にすると、指定したGitHubディレクトリに加えられた変更がTiDB Cloudに自動的にデプロイされ、 TiDB Cloudコンソールに加えられた変更もGitHubにプッシュされます。対応するデプロイ情報とコミット情報は、データアプリのデプロイ履歴で確認できます。
        -   無効にすると、指定した GitHub ディレクトリで行われた変更はTiDB Cloudにデプロイ**されず**、 TiDB Cloudコンソールで行われた変更も GitHub にプッシュされ**ません**。

5.  **[接続の確認]を**クリックします。

## ステップ2. データアプリの構成をGitHubと同期する {#step-2-synchronize-data-app-configurations-with-github}

[データアプリを作成する](/tidb-cloud/data-service-manage-data-app.md)ときに GitHub 接続が有効になっている場合、 TiDB Cloud は、アプリの作成直後にこのデータ アプリの構成ファイルを GitHub にプッシュします。

アプリ作成後にGitHub接続が有効になっている場合は、データアプリの設定をGitHubと同期するためのデプロイメント操作を実行する必要があります。例えば、 **「デプロイメント」**タブをクリックし、このデータアプリのデプロイメントを再デプロイします。

デプロイ操作が完了したら、指定したGitHubディレクトリを確認してください。データアプリの設定ファイルが`tidb-cloud-data-service`までにディレクトリにコミットされているはずです。これは、データアプリがGitHubに正常に接続していることを意味します。ディレクトリ構造は次のとおりです。

    ├── <Your Data App directory on GitHub>
    │   ├── data_sources
    │   │   └── cluster.json  # specifies the linked clusters.
    │   ├── dataapp_config.json # specifies the Data APP ID, name, type, version, and description.
    │   ├── http_endpoints
    │   │   ├── config.json # specifies the endpoints.
    │   │   └── sql # contains SQL files of the endpoints.
    │   │       ├── <method>-<endpoint-path1>.sql
    │   │       ├── <method>-<endpoint-path2>.sql
    │   │       └── <method>-<endpoint-path3>.sql

## ステップ3. データアプリを変更する {#step-3-modify-your-data-app}

**自動同期とデプロイメント**が有効になっている場合は、GitHub またはTiDB Cloudコンソールを使用してデータ アプリを変更できます。

-   [オプション1: GitHub上のファイルを更新してデータアプリを変更する](#option-1-modify-your-data-app-by-updating-files-on-github)
-   [オプション2: TiDB Cloudコンソールでデータアプリを変更する](#option-2-modify-your-data-app-in-the-tidb-cloud-console)

> **注記：**
>
> GitHub とTiDB Cloudコンソールで同時にデータ アプリを変更した場合、競合を解決するには、コンソールで行った変更を破棄するか、コンソールの変更で GitHub の変更を上書きするかを選択できます。

### オプション1: GitHub上のファイルを更新してデータアプリを変更する {#option-1-modify-your-data-app-by-updating-files-on-github}

設定ファイルを更新するときは、次の点に注意してください。

| ファイルディレクトリ                                      | 注記                                                                                                                                                                                   |
| ----------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `data_source/cluster.json`                      | このファイルを更新する際は、リンクされたクラスターにアクセスできることを確認してください。クラスターIDはクラスターURLから取得できます。例えば、クラスターURLが`https://tidbcloud.com/clusters/1234567891234567890/overview`の場合、クラスターIDは`1234567891234567890`です。 |
| `http_endpoints/config.json`                    | エンドポイントを変更するときは、 [HTTPエンドポイント構成](/tidb-cloud/data-service-app-config-files.md#http-endpoint-configuration)で説明されているルールに従ってください。                                                       |
| `http_endpoints/sql/method-<endpoint-path>.sql` | `http_endpoints/sql`ディレクトリ内の SQL ファイルを追加または削除するには、対応するエンドポイント構成も更新する必要があります。                                                                                                         |
| `datapp_config.json`                            | このファイルの`app_id`フィールドは変更しないでください。ただし、 `dataapp_config.json`ファイルが別のデータアプリからコピーされたもので、現在のデータアプリの ID に更新する必要がある場合は除きます。変更しないと、この変更によってトリガーされるデプロイは失敗します。                                 |

これらのファイル内のフィールド構成の詳細については、 [データアプリの構成ファイル](/tidb-cloud/data-service-app-config-files.md)参照してください。

ファイルの変更がコミットされプッシュされると、 TiDB Cloud は最新の変更内容を含むデータアプリを GitHub に自動的にデプロイします。デプロイのステータスとコミット情報は、デプロイ履歴で確認できます。

### オプション2: TiDB Cloudコンソールでデータアプリを変更する {#option-2-modify-your-data-app-in-the-tidb-cloud-console}

TiDB Cloudコンソールで[データアプリのエンドポイントを変更する](/tidb-cloud/data-service-manage-endpoint.md)実行した後 (エンドポイントの変更など)、次のように変更を確認して GitHub にデプロイできます。

1.  右上隅の**「デプロイ」を**クリックします。変更内容を確認するためのダイアログが表示されます。
2.  レビューに応じて、次のいずれかを実行します。

    -   現在の下書きに基づいてさらに変更を加えたい場合は、このダイアログを閉じて変更を加えてください。
    -   現在の変更を最後のデプロイメントに戻す場合は、 **「下書きを破棄」**をクリックします。
    -   現在の変更に問題がなければ、変更の説明（オプション）を記入し、 **「デプロイてGitHubにプッシュ」を**クリックします。デプロイのステータスは上部のバナーに表示されます。

デプロイメントが成功すると、 TiDB Cloudコンソールで行われた変更が自動的に GitHub にプッシュされます。

## 既存のデータアプリの構成をインポートする {#import-configurations-of-an-existing-data-app}

既存のデータ アプリの構成を新しいデータ アプリにインポートするには、次の手順を実行します。

1.  既存のデータ アプリの構成ファイルを GitHub 上の新しいブランチまたはディレクトリにコピーします。

2.  プロジェクトの[**データサービス**](https://tidbcloud.com/project/data-service)ページ目、GitHub に接続せずに[新しいデータアプリを作成する](/tidb-cloud/data-service-manage-data-app.md#create-a-data-app) 。

3.  **自動同期とデプロイメント**が有効になっている場合、 [新しいデータアプリをGitHubに接続する](#step-1-connect-your-data-app-to-github) 。新しいデータアプリのターゲットリポジトリ、ブランチ、ディレクトリを指定する際は、コピーした設定ファイルを含む新しいパスを使用してください。

4.  新しいデータアプリのIDと名前を取得します。左側のペインで新しいデータアプリの名前をクリックすると、右側のペインの**「データアプリのプロパティ」**領域でアプリIDと名前を取得できます。

5.  GitHub の新しいパスで、 `datapp_config.json`ファイルの`app_id`と`app_name`取得した ID と名前に更新し、変更をプッシュします。

    ファイルの変更が GitHub にプッシュされると、 TiDB Cloud は最新の変更を反映した新しいデータ アプリを自動的にデプロイします。

6.  GitHub からインポートされた構成を表示するには、 TiDB Cloudコンソールの Web ページを更新します。

    デプロイメント履歴でデプロイメントのステータスとコミット情報を表示することもできます。

## GitHub接続を編集する {#edit-github-connection}

データ アプリの GitHub 接続を編集する場合 (リポジトリ、ブランチ、ディレクトリの切り替えなど)、次の手順を実行します。

1.  プロジェクトの[**データサービス**](https://tidbcloud.com/project/data-service)ページに移動します。

2.  左側のペインで、対象のデータ アプリの名前をクリックして詳細を表示します。

3.  **GitHubに接続**エリアで、 <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" color="gray.1"><path d="M11 3.99998H6.8C5.11984 3.99998 4.27976 3.99998 3.63803 4.32696C3.07354 4.61458 2.6146 5.07353 2.32698 5.63801C2 6.27975 2 7.11983 2 8.79998V17.2C2 18.8801 2 19.7202 2.32698 20.362C2.6146 20.9264 3.07354 21.3854 3.63803 21.673C4.27976 22 5.11984 22 6.8 22H15.2C16.8802 22 17.7202 22 18.362 21.673C18.9265 21.3854 19.3854 20.9264 19.673 20.362C20 19.7202 20 18.8801 20 17.2V13M7.99997 16H9.67452C10.1637 16 10.4083 16 10.6385 15.9447C10.8425 15.8957 11.0376 15.8149 11.2166 15.7053C11.4184 15.5816 11.5914 15.4086 11.9373 15.0627L21.5 5.49998C22.3284 4.67156 22.3284 3.32841 21.5 2.49998C20.6716 1.67156 19.3284 1.67155 18.5 2.49998L8.93723 12.0627C8.59133 12.4086 8.41838 12.5816 8.29469 12.7834C8.18504 12.9624 8.10423 13.1574 8.05523 13.3615C7.99997 13.5917 7.99997 13.8363 7.99997 14.3255V16Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg>接続設定のダイアログボックスが表示されます。

4.  ダイアログ ボックスで、データ アプリのリポジトリ、ブランチ、ディレクトリを変更します。

    > **注記：**
    >
    > -   ディレクトリはスラッシュ（ `/` ）で始まる必要があります。例えば、 `/mydata` 。指定したディレクトリがターゲットリポジトリとブランチに存在しない場合は、自動的に作成されます。
    > -   リポジトリ、ブランチ、ディレクトリの組み合わせは、設定ファイルのパスを識別します。このパスはデータアプリ間で一意である必要があります。指定したパスが既に別のデータアプリで使用されている場合は、新しいパスを指定する必要があります。そうしないと、 TiDB Cloudコンソールで現在のデータアプリ用に設定されたエンドポイントによって、指定したパス内のファイルが上書きされます。
    > -   指定したパスに別のデータ アプリからコピーされた構成ファイルが含まれており、これらのファイルを現在のデータ アプリにインポートする場合は、 [既存のデータアプリの構成をインポートする](#import-configurations-of-an-existing-data-app)参照してください。

5.  TiDB Cloudコンソールまたは GitHub のいずれかで行われたデータ アプリの変更が相互に同期されるようにするには、**自動同期とデプロイメントの構成を**有効にします。

    -   有効にすると、指定したGitHubディレクトリに加えられた変更がTiDB Cloudに自動的にデプロイされ、 TiDB Cloudコンソールに加えられた変更もGitHubにプッシュされます。対応するデプロイ情報とコミット情報は、データアプリのデプロイ履歴で確認できます。
    -   無効にすると、指定した GitHub ディレクトリで行われた変更はTiDB Cloudにデプロイ**されず**、 TiDB Cloudコンソールで行われた変更も GitHub にプッシュされ**ません**。

6.  **[接続の確認]を**クリックします。

## GitHub接続を削除する {#remove-github-connection}

データ アプリを GitHub に接続したくなくなった場合は、次の手順を実行します。

1.  プロジェクトの[**データサービス**](https://tidbcloud.com/project/data-service)ページに移動します。
2.  左側のペインで、対象のデータ アプリの名前をクリックして詳細を表示します。
3.  **[設定]**タブの**[GitHub に接続]**領域で**[切断]**をクリックします。
4.  切断を確認するには、 **[切断] を**クリックします。

切断操作後、データ アプリ構成ファイルは GitHub ディレクトリに残りますが、 `tidb-cloud-data-service`によって同期されなくなります。
