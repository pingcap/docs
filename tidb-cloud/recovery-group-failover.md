---
title: Failover and Reprotect Databases
summary: リカバリ グループを使用して、 TiDB Cloudクラスター間でデータベースをフェイルオーバーし、再保護する方法を学習します。
---

# データベースのフェイルオーバーと再保護 {#failover-and-reprotect-databases}

リカバリ グループ内のデータベースは、通常はクラウド サービス プロバイダーの別のリージョンにあるクラスター間で複製されます。

**フェールオーバー**アクションは、セカンダリ リージョン内の複製されたデータベースを新しいプライマリ コピーに昇格させ、リージョンの停止中でも継続的な可用性を確保します。

リージョンの障害が解決されると、**再保護**アクションを使用して、リカバリ リージョンから元のリージョンへのレプリケーションを元に戻す機能が実行されます。これにより、データベースは新しいリージョンに影響を与える将来の災害から保護され、必要に応じて元のリージョンへの移行の準備が整います。

## 前提条件 {#prerequisites}

フェイルオーバーを実行する前に、リカバリ グループが作成され、セカンダリ クラスターに正常にレプリケートされている必要があります。詳細については、 [リカバリグループの使用を開始する](/tidb-cloud/recovery-group-get-started.md)参照してください。

![Protected Recovery Group](/media/tidb-cloud/recovery-group/recovery-group-protected.png)

## リカバリグループを使用したデータベースのフェイルオーバー {#failover-databases-using-a-recovery-group}

災害が発生した場合は、リカバリ グループを使用してデータベースをセカンダリ クラスターにフェールオーバーできます。

1.  [TiDB Cloudコンソール](https://tidbcloud.com/)で、<mdsvgicon name="icon-left-projects">左下隅で、複数のプロジェクトがある場合は対象プロジェクトに切り替えて、 **[プロジェクト設定]**をクリックします。</mdsvgicon>

2.  **プロジェクト設定**ナビゲーション ペインで、**回復グループ**をクリックします。

3.  **[リカバリ グループ]**ページで、フェールオーバーするリカバリ グループの名前を見つけます。

4.  回復グループの**[アクション]**メニューをクリックし、 **[フェールオーバー]**をクリックします。フェールオーバー ダイアログが表示されます。

    > **警告**
    >
    > フェイルオーバーを実行すると、既存のレプリケーション関係が切断されます。

5.  プライマリ コピーに昇格するセカンダリTiDB Cloudクラスターを選択します。選択したクラスターが正常な状態であることを確認します。

6.  確認エントリに**「フェールオーバー」**と入力し、 **「フェールオーバー グループを理解しました」**をクリックしてフェールオーバーを開始し、フェールオーバーの潜在的な中断の性質を理解していることを確認します。

    ![Fail Over Recovery Group](/media/tidb-cloud/recovery-group/recovery-group-failover.png)

## リカバリグループを使用してデータベースを再保護する {#reprotect-databases-using-a-recovery-group}

フェイルオーバーが完了すると、セカンダリ クラスター上のレプリカ データベースがプライマリ コピーになります。ただし、フェイルオーバー プロセスによってレプリケーション関係が停止されるため、これらのデータベースは将来の災害に対して保護されません。

災害の影響を受けた元のプライマリ クラスターを再度オンラインにできる場合は、**再保護**アクションを使用して、リカバリ領域から元の領域へのレプリケーションを再確立できます。

![Unprotected Recovery Group](/media/tidb-cloud/recovery-group/recovery-group-unprotected.png)

1.  [TiDB Cloudコンソール](https://tidbcloud.com/)で、<mdsvgicon name="icon-left-projects">左下隅で、複数のプロジェクトがある場合は対象プロジェクトに切り替えて、 **[プロジェクト設定]**をクリックします。</mdsvgicon>

2.  **プロジェクト設定**ナビゲーション ペインで、**回復グループ**をクリックします。

3.  **[回復グループ]**ページで、再保護する回復グループの名前を見つけます。

    > **注記**
    >
    > **リカバリ グループの詳細**ページには、現在のステータスやレプリケーション トポロジなど、リカバリ グループに関する情報が表示されます。再保護の同期中は、転送されるデータの量により、プライマリ クラスターまたはセカンダリ クラスターでのオンライン クエリのパフォーマンスが影響を受ける可能性があります。データベースの再保護は、あまり忙しくない期間にスケジュールすることをお勧めします。

    > **警告**
    >
    > 再保護操作を実行するために必要なデータ レプリケーションの一環として、選択したデータベースの内容は、ターゲット クラスターで (新しい) プライマリ クラスターのデータベースの内容に置き換えられます。ターゲット クラスターの一意の内容を保持する場合は、再保護操作を実行する前にバックアップを完了してください。

4.  回復グループの**[アクション]**メニューをクリックし、 **[再保護]**をクリックします。再保護ダイアログが表示されます。

5.  再保護操作を開始するには、 **「再保護」**をクリックして再保護操作を確認します。

    ![Reprotect Recovery Group](/media/tidb-cloud/recovery-group/recovery-group-reprotected.png)
