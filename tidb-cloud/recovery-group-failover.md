---
title: Failover and Reprotect Databases
summary: リカバリ グループを使用して、 TiDB Cloudクラスター間でデータベースをフェイルオーバーし、再保護する方法を学習します。
---

# データベースのフェイルオーバーと再保護 {#failover-and-reprotect-databases}

リカバリ グループ内のデータベースは、通常はクラウド サービス プロバイダーの異なるリージョンにあるクラスター間で複製されます。

**フェールオーバー**アクションは、セカンダリ リージョン内の複製されたデータベースを新しいプライマリ コピーに昇格させ、リージョンの停止中でも継続的な可用性を確保します。

リージョンの障害が解消されると、 **「再保護」**アクションを使用して、リカバリリージョンから元のリージョンへのレプリケーションを元に戻すことができます。これにより、データベースは新しいリージョンに影響を与える将来の災害から保護され、必要に応じて元のリージョンへの移行の準備が整います。

## 前提条件 {#prerequisites}

フェイルオーバーを実行する前に、リカバリグループを作成し、セカンダリクラスタへのレプリケーションを正常に実行しておく必要があります。詳細については、 [リカバリグループの使用を開始する](/tidb-cloud/recovery-group-get-started.md)参照してください。

![Protected Recovery Group](/media/tidb-cloud/recovery-group/recovery-group-protected.png)

## リカバリグループを使用したデータベースのフェイルオーバー {#failover-databases-using-a-recovery-group}

災害が発生した場合、リカバリ グループを使用してデータベースをセカンダリ クラスターにフェールオーバーできます。

1.  [TiDB Cloudコンソール](https://tidbcloud.com/)で、左上隅のコンボ ボックスを使用してターゲット プロジェクトに切り替えます。

2.  左側のナビゲーション ペインで、 **[回復グループ]**をクリックします。

3.  **[回復グループ]**ページで、フェールオーバーする回復グループの名前を見つけます。

4.  回復グループの**「アクション」**メニューをクリックし、 **「フェールオーバー」**をクリックします。フェールオーバーダイアログが表示されます。

    > **警告**
    >
    > フェイルオーバーを実行すると、既存のレプリケーション関係が切断されます。

5.  プライマリコピーに昇格するセカンダリTiDB Cloudクラスタを選択します。選択したクラスタが正常な状態であることを確認してください。

6.  確認エントリに**「Failover」**と入力し、「 **I understand, failover group」をクリックしてフェールオーバーを開始し、フェール**オーバーの潜在的な中断の性質を理解していることを確認します。

    ![Fail Over Recovery Group](/media/tidb-cloud/recovery-group/recovery-group-failover.png)

## リカバリグループを使用してデータベースを再保護する {#reprotect-databases-using-a-recovery-group}

フェイルオーバーが完了すると、セカンダリクラスタ上のレプリカデータベースがプライマリコピーになります。ただし、フェイルオーバープロセスによってレプリケーション関係が停止されるため、これらのデータベースは将来の災害から保護されません。

災害の影響を受けた元のプライマリ クラスターを再度オンラインにできる場合は、再**保護**アクションを使用して、復旧リージョンから元のリージョンへのレプリケーションを再確立できます。

![Unprotected Recovery Group](/media/tidb-cloud/recovery-group/recovery-group-unprotected.png)

1.  [TiDB Cloudコンソール](https://tidbcloud.com/)で、左上隅のコンボ ボックスを使用してターゲット プロジェクトに切り替えます。

2.  左側のナビゲーション ペインで、 **[回復グループ]**をクリックします。

3.  **[回復グループ]**ページで、再保護する回復グループの名前を見つけます。

    > **注記**
    >
    > **リカバリグループの詳細**ページには、現在のステータスやレプリケーショントポロジなど、リカバリグループに関する情報が表示されます。再保護同期中は、転送されるデータ量が多いため、プライマリクラスタまたはセカンダリクラスタでのオンラインクエリのパフォーマンスに影響が出る可能性があります。データベースの再保護は、比較的混雑していない時間帯にスケジュールすることをお勧めします。

    > **警告**
    >
    > 再保護操作に必要なデータレプリケーションの一環として、ターゲットクラスタ上の選択されたデータベースの内容は、（新しい）プライマリクラスタのデータベースの内容に置き換えられます。ターゲットクラスタ上の固有のコンテンツを保持する場合は、再保護操作を実行する前にバックアップを完了してください。

4.  回復グループの**「アクション」**メニューをクリックし、 **「再保護」**をクリックします。再保護ダイアログが表示されます。

5.  再保護操作を開始するには、 **「再保護」を**クリックして再保護操作を確認します。

    ![Reprotect Recovery Group](/media/tidb-cloud/recovery-group/recovery-group-reprotected.png)
