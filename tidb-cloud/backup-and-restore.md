---
title: Back Up and Restore TiDB Cloud Dedicated Data
summary: TiDB Cloud Dedicated クラスターをバックアップおよび復元する方法を学びます。
aliases: ['/tidbcloud/restore-deleted-tidb-cluster']
---

# TiDB Cloud専用データのバックアップと復元 {#back-up-and-restore-tidb-cloud-dedicated-data}

このドキュメントでは、 TiDB Cloud Dedicated クラスタデータをTiDB Cloud上でバックアップおよび復元する方法について説明します。TiDB TiDB Cloud Dedicated は自動バックアップと手動バックアップをサポートしています。また、バックアップデータを新しいクラスタに復元したり、削除したクラスタをごみ箱から復元したりすることもできます。

> **ヒント**
>
> TiDB Cloud Starter またはTiDB Cloud Essential クラスターでデータをバックアップおよび復元する方法については、 [TiDB Cloud StarterまたはEssentialでデータをバックアップおよび復元する](/tidb-cloud/backup-and-restore-serverless.md)参照してください。

## 制限事項 {#limitations}

-   v6.2.0 以降のバージョンのクラスターの場合、 TiDB Cloud Dedicated は、デフォルトでバックアップからのユーザー アカウントと SQL バインディングの復元をサポートします。
-   TiDB Cloud Dedicated は、 `mysql`スキーマに保存されているシステム変数の復元をサポートしていません。
-   最初にデータをインポートし、次に**手動で**スナップショットバックアップを実行し、最後にポイントインタイムリストアを有効にすることを推奨します。TiDB TiDB Cloudコンソールからインポートされたデータは変更ログを生成**しない**ため、自動的に検出およびバックアップすることはできません。詳細については、 [クラウドストレージからTiDB Cloud DedicatedにCSVファイルをインポートする](/tidb-cloud/import-csv-files.md)参照してください。
-   ポイントインタイムリストアを複数回オン/オフにした場合、最後にポイントインタイムリストアが有効になった後の復元可能範囲内の時点のみを選択できます。それ以前の復元可能範囲にはアクセスできません。
-   **ポイントインタイム リストア**と**デュアルリージョンバックアップ**のスイッチを同時に変更しないでください。

## バックアップ {#backup}

### バックアップページをビュー {#view-the-backup-page}

1.  プロジェクトの[**クラスター**](https://tidbcloud.com/project/clusters)ページで、ターゲット クラスターの名前をクリックして、概要ページに移動します。

    > **ヒント：**
    >
    > 左上隅のコンボ ボックスを使用して、組織、プロジェクト、クラスターを切り替えることができます。

2.  左側のナビゲーション ペインで、 **[データ]** &gt; **[バックアップ] を**クリックします。

### 自動バックアップをオンにする {#turn-on-auto-backup}

TiDB Cloud Dedicatedは、 [スナップショットバックアップ](https://docs.pingcap.com/tidb/stable/br-snapshot-guide)と[ログバックアップ](https://docs.pingcap.com/tidb/stable/br-pitr-guide)両方をサポートしています。スナップショットバックアップを使用すると、バックアップポイントにデータを復元できます。デフォルトでは、スナップショットバックアップは自動的に作成され、バックアップ保持ポリシーに従って保存されます。自動バックアップはいつでも無効にできます。

#### ポイントインタイムリストアを有効にする {#turn-on-point-in-time-restore}

> **注記**
>
> ポイントインタイム リストア機能は、v6.4.0 以降のTiDB Cloud Dedicated クラスターでサポートされています。

この機能は、任意の時点のデータを新しいクラスターに復元することをサポートします。この機能を使用すると、次のことが可能になります。

-   災害復旧における RPO を削減します。
-   エラー イベントの前の時点を復元することにより、データ書き込みエラーのケースを解決します。
-   ビジネスの履歴データを監査します。

この機能を有効にすることを強くお勧めします。コストはスナップショットバックアップと同じです。詳細については、 [データバックアップコスト](https://www.pingcap.com/tidb-dedicated-pricing-details#backup-storage-cost)を参照してください。

TiDB Cloud Dedicated クラスターでこの機能を有効にするには、次の手順を実行します。

1.  クラスターの[**バックアップ**](#view-the-backup-page)ページに移動します。

2.  **バックアップ設定**をクリックします。

3.  **自動バックアップ**スイッチを**オン**に切り替えます。

4.  **ポイントインタイム復元**スイッチを**オン**に切り替えます。

    > **警告**
    >
    > ポイントインタイムリストアは、次のバックアップタスクが完了した後にのみ有効になります。より早く有効にするには、有効化後に[手動でバックアップを実行する](#perform-a-manual-backup)実行してください。

5.  変更を保存するには、 **「保存」**をクリックします。

#### バックアップスケジュールを設定する {#configure-backup-schedule}

TiDB Cloud Dedicatedは、毎日と毎週のバックアップスケジュールをサポートしています。デフォルトでは、バックアップスケジュールは毎日に設定されています。スナップショットバックアップを開始する時刻を、日ごとまたは週ごとに指定できます。

TiDB Cloud Dedicated クラスターのバックアップ スケジュールを構成するには、次の手順を実行します。

1.  クラスターの[**バックアップ**](#view-the-backup-page)ページに移動します。

2.  **バックアップ設定**をクリックします。

3.  **自動バックアップ**スイッチを**オン**に切り替えます。

4.  バックアップ スケジュールを次のように構成します。

    -   **「バックアップサイクル」**で、「**日次バックアップ」**または**「週次バックアップ」**タブをクリックします。**週次バックアップ**の場合は、バックアップを実行する曜日を指定する必要があります。

        > **警告**
        >
        > -   週次バックアップが有効になっている場合、ポイントインタイム リストア機能はデフォルトで有効になっており、無効にすることはできません。
        > -   バックアップサイクルを週次から日次に変更した場合、ポイントインタイムリストア機能は元の設定のままです。必要に応じて手動で無効にすることができます。

    -   **[バックアップ時刻]**で、毎日または毎週のクラスター バックアップの開始時刻をスケジュールします。

        優先バックアップ時間を指定しない場合は、 TiDB Cloudによってデフォルトのバックアップ時間 (クラスターが配置されているリージョンのタイムゾーンの午前 2 時) が割り当てられます。

        > **注記**
        >
        > -   データインポートジョブの進行中は、バックアップジョブは自動的に遅延されます。データインポート中またはクラスターのスケーリング中は、手動バックアップを実行**しないでください**。

    -   **バックアップ保持期間**では、バックアップデータの最小保持期間を設定します。デフォルトの期間は7日間です。業務への影響を最小限に抑えるため、ワークロードが少ない時間帯に自動バックアップをスケジュールすることをお勧めします。

        > **注記**
        >
        > -   自動バックアップは、最新のものを除き、保存期間を超えるとすべて削除されます。最新の自動バックアップは、手動で削除しない限り削除されません。これにより、誤って削除した場合でもクラスターデータを復元できます。
        > -   クラスターを削除すると、保存期間内の有効期間を持つ自動バックアップはごみ箱に移動されます。

### デュアルリージョンバックアップをオンにする {#turn-on-dual-region-backup}

> **注記：**
>
> -   現在、デュアルリージョンバックアップ機能は、AWS と Google Cloud でホストされているクラスターでのみ使用できます。
> -   Google Cloud でホストされるTiDB Cloud Dedicated クラスタは、Google Cloud Storage とシームレスに連携します。Google Cloud Storage と同様に、 **TiDB Cloud Dedicated は Google デュアルリージョンstorageと同じマルチリージョン コード内でのみデュアルリージョン ペアリングをサポートします**。例えばアジアでは現在、デュアルリージョンstorageするには東京と大阪をペアリングする必要があります。詳細については、 [デュアルリージョン](https://cloud.google.com/storage/docs/locations#location-dr)をご覧ください。

TiDB Cloud Dedicatedは、クラスタリージョンから別のリージョンにバックアップを複製することで、デュアルリージョンバックアップをサポートします。この機能を有効にすると、すべてのバックアップが指定されたリージョンに自動的に複製されます。これにより、リージョンをまたいだデータ保護とディザスタリカバリ機能が実現します。1時間以内に約99%のデータがセカンダリリージョンに複製されると推定されます。

デュアルリージョンバックアップの料金には、バックアップstorageの使用料とリージョン間データ転送料が含まれます。詳細については、 [データバックアップコスト](https://www.pingcap.com/tidb-dedicated-pricing-details#backup-storage-cost)をご覧ください。

TiDB Cloud Dedicated クラスターのデュアルリージョン バックアップを有効にするには、次の手順を実行します。

1.  クラスターの[**バックアップ**](#view-the-backup-page)ページに移動します。

2.  **バックアップ設定**をクリックします。

3.  **デュアルリージョンバックアップ**スイッチを**オン**に切り替えます。

4.  **「セカンダリリージョン」**ドロップダウンリストから、バックアップ ファイルを保存するリージョンを選択します。

5.  変更を保存するには、 **「保存」**をクリックします。

### 自動バックアップをオフにする {#turn-off-auto-backup}

> **注記**
>
> 自動バックアップをオフにすると、ポイントインタイム復元もデフォルトでオフになります。

TiDB Cloud Dedicated クラスターの自動バックアップをオフにするには、次の手順を実行します。

1.  クラスターの[**バックアップ**](#view-the-backup-page)ページに移動します。

2.  **バックアップ設定**をクリックします。

3.  **自動バックアップ**スイッチを**オフ**に切り替えます。

4.  変更を保存するには、 **「保存」**をクリックします。

### デュアルリージョンバックアップをオフにする {#turn-off-dual-region-backup}

> **ヒント**
>
> デュアルリージョンバックアップを無効にしても、セカンダリリージョンのバックアップはすぐには削除されません。これらのバックアップは、バックアップ保持スケジュールに従って後日クリーンアップされます。すぐに削除するには、手動で[バックアップを削除する](#delete-backups)実行してください。

TiDB Cloud Dedicated クラスターのデュアルリージョン バックアップをオフにするには、次の手順を実行します。

1.  クラスターの[**バックアップ**](#view-the-backup-page)ページに移動します。

2.  **バックアップ設定**をクリックします。

3.  **デュアルリージョンバックアップ**スイッチを**オフ**に切り替えます。

4.  変更を保存するには、 **「保存」**をクリックします。

### 手動バックアップを実行する {#perform-a-manual-backup}

手動バックアップはユーザーが開始するバックアップであり、必要に応じてデータを既知の状態にバックアップし、いつでもその状態に復元することができます。

> **注記**
>
> -   手動バックアップは、手動で削除することを選択するか、アカウントが閉鎖されるまで無期限に保持されます。
> -   TiDB Cloud Dedicated クラスターが削除されると、既存の手動バックアップはごみ箱に移動され、手動で削除されるかアカウントが閉じられるまでそこに保存されます。

TiDB Cloud Dedicated クラスターに手動バックアップを適用するには、次の手順を実行します。

1.  クラスターの[**バックアップ**](#view-the-backup-page)ページに移動します。

2.  右上隅で、 **...** &gt;**手動バックアップ**をクリックします。

3.  表示されたダイアログで、**名前**を入力します。

4.  **「確認」**をクリックします。これでクラスターデータがバックアップされます。

### バックアップを削除する {#delete-backups}

#### バックアップファイルを削除する {#delete-backup-files}

TiDB Cloud Dedicated クラスターの既存のバックアップ ファイルを削除するには、次の手順を実行します。

1.  クラスターの[**バックアップ**](#view-the-backup-page)ページに移動します。

2.  削除する対応するバックアップ ファイルを見つけて、 **[アクション]**列の**[...]** &gt; **[削除]**をクリックします。

#### 実行中のバックアップジョブを削除する {#delete-a-running-backup-job}

TiDB Cloud Dedicated クラスターの実行中のバックアップ ジョブを削除するには、 [**バックアップファイルを削除する**](#delete-backup-files)と同様の手順に従います。

1.  クラスターの[**バックアップ**](#view-the-backup-page)ページに移動します。

2.  **保留**中または**実行中**状態の実行中のバックアップ ジョブを見つけて、 **[アクション]**列で**[...]** &gt; **[削除] を**クリックします。

## 復元する {#restore}

### 新しいクラスターにデータを復元する {#restore-data-to-a-new-cluster}

> **注記**
>
> バックアップから TiDB クラスターを復元すると、復元プロセスによって元のタイムゾーン設定が上書きされずに保持されます。

TiDB Cloud Dedicated クラスターのデータをバックアップから新しいクラスターに復元するには、次の手順を実行します。

1.  クラスターの[**バックアップ**](#view-the-backup-page)ページに移動します。

2.  **「復元」**をクリックします。設定ウィンドウが表示されます。

3.  **[復元モード]**で、 **[リージョンから復元]**を選択し、バックアップ ストアの領域を指定します。

    > **注記**
    >
    > -   **復元元リージョン**のデフォルト値は、バックアップ クラスターと同じです。

4.  **復元モード**では、任意の時点のデータまたは選択したバックアップを新しいクラスターに復元することを選択します。

    <SimpleTab>
     <div label="Select Time Point">

    バックアップ保持期間内の任意の時点のデータを新しいクラスターに復元するには、**バックアップ設定**の**ポイントインタイム復元が**オンになっていることを確認してから、次の手順を実行します。

    -   **[時点の選択]を**クリックします。
    -   復元したい**日付**と**時刻**を選択します。

    </div>

    <div label="Select Backup Name">

    選択したバックアップを新しいクラスターに復元するには、次の手順を実行します。

    -   **バックアップ名の選択を**クリックします。
    -   復元するバックアップを選択します。

    </div>
     </SimpleTab>

5.  **[復元先リージョン]**で、**バックアップ設定**で構成された**プライマリリージョン**と同じリージョンを選択します。

6.  **「復元」**ウィンドウでは、必要に応じて次の変更を行うこともできます。

    -   クラスター名を設定します。
    -   クラスターのポート番号を更新します。
    -   クラスターのノード数、vCPU と RAM、およびstorageを増やします。

7.  **[復元]を**クリックします。

    クラスターの復元プロセスが開始され、**パスワード設定**ダイアログ ボックスが表示されます。

8.  **[パスワード設定]**ダイアログ ボックスで、クラスターに接続するためのルート パスワードを設定し、 **[保存]**をクリックします。

### 削除されたクラスターを復元する {#restore-a-deleted-cluster}

> **注記：**
>
> 削除されたクラスターは、特定の時点に復元することはできません。復元できるのは、自動バックアップまたは手動バックアップのみです。

削除されたクラスターをごみ箱から復元するには、次の手順を実行します。

1.  [TiDB Cloudコンソール](https://tidbcloud.com)で、左上隅のコンボ ボックスを使用してターゲット プロジェクトに切り替えます。

2.  左側のナビゲーション ペインで、 **[プロジェクト設定]** &gt; **[ごみ箱]**をクリックします。

3.  **[ごみ箱]**ページで、復元するクラスターを見つけて、 **[アクション]**列の**[...]**をクリックし、 **[バックアップ]**をクリックします。

4.  **[バックアップ]**ページで、必要なバックアップ時間を見つけて、[**アクション]**列の**[...]**をクリックし、 **[復元] を**クリックします。

5.  **[復元]**ページで、新しいクラスターの名前を指定し、必要に応じて次の変更を行います。

    -   クラスターのポート番号を更新します。
    -   クラスターのノード数、vCPU と RAM、およびstorageを増やします。

6.  **[概要]**セクションで復元情報を確認し、 **[復元]**をクリックします。

    クラスターの復元プロセスが開始され、**パスワード設定**ダイアログ ボックスが表示されます。

7.  **[パスワード設定]**ダイアログ ボックスで、クラスターに接続するためのルート パスワードを設定し、 **[保存]**をクリックします。
